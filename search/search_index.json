{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"WebFramework Documentation","text":"<p>Welcome to the WebFramework documentation. WebFramework is a lightweight, secure-by-default PHP microframework built on top of the Slim Framework. It provides a cohesive set of services around database management, ORM, caching, authentication, middleware, templating, translations, instrumentation, and more \u2013 giving you Laravel-like features without the bloat.</p> <p>Perfect for developers who love Slim's simplicity but need full-featured components for building modern PHP applications and REST APIs.</p>"},{"location":"#installation","title":"Installation","text":""},{"location":"#skeleton-application","title":"Skeleton Application","text":"<p>WebFramework is installed via Composer. You can install a skeleton application to get you started:</p> <pre><code>composer create-project avoutic/web-framework-skeleton\n</code></pre>"},{"location":"#existing-project","title":"Existing project","text":"<p>You can also add WebFramework to an existing project by installing it via Composer:</p> <pre><code>composer require avoutic/web-framework\n</code></pre> <p>You then probably want to add something like the following to your <code>composer.json</code> file, to make sure the core files are installed:</p> <pre><code>    \"scripts\": {\n        \"post-install-cmd\": [\n            \"php -r \\\"copy('vendor/avoutic/web-framework/public/index.php', 'public/index.php');\\\"\",\n            \"php -r \\\"copy('vendor/avoutic/web-framework/scripts/framework.php', 'framework');\\\"\"\n        ],\n        \"post-update-cmd\": [\n            \"php -r \\\"copy('vendor/avoutic/web-framework/public/index.php', 'public/index.php');\\\"\",\n            \"php -r \\\"copy('vendor/avoutic/web-framework/scripts/framework.php', 'framework');\\\"\"\n        ]\n    },\n</code></pre>"},{"location":"#directory-structure","title":"Directory Structure","text":"<p>Applications using WebFramework typically have the following directory structure:</p> <ul> <li>actions: Contains files for each endpoint and related API functions.</li> <li>config: Contains the configuration files for the application.</li> <li>definitions: Contains the PHP-DI definitions for the application.</li> <li>public: The location for the core <code>index.php</code> and external static files like images, CSS, and JavaScript.</li> <li>migrations: Contains the database migrations for the application.</li> <li>scripts: Contains scripts for tasks, migrations, and other automation tasks.</li> <li>src: Contains the core application/business logic and model files.</li> <li>templates: Contains the templates used by the actions.</li> <li>tests: Contains the tests for the application.</li> <li>translations: Contains the translation files for the application.</li> </ul> <p>You are free to organize your project in any way you like, but the above structure is recommended. You will need to configure the PSR-4 autoloading in your <code>composer.json</code> file to match the directory structure. The skeleton uses the following configuration:</p> <pre><code>    \"autoload\": {\n        \"psr-4\": {\n            \"App\\\\\": \"src/\",\n            \"App\\\\Actions\\\\\": \"actions/\",\n            \"App\\\\Routes\\\\\": \"routes/\"\n        }\n    },\n    \"autoload-dev\": {\n        \"psr-4\": {\n            \"WebFramework\\\\PHPStan\\\\\": \"vendor/avoutic/web-framework/phpstan/\"\n        }\n    },\n</code></pre>"},{"location":"#documentation-contents","title":"Documentation Contents","text":"<p>This documentation is organized into several sections, each focusing on a specific aspect of WebFramework. Click on the links below to explore each section in detail:</p> <ul> <li>Installation Guide: Instructions for installing WebFramework and setting up a base project.</li> <li>Migration Guide: Guidance on migrating between different versions of WebFramework.</li> <li>Configuration Management: How to manage and access configuration settings in your application.</li> <li>Dependency Injection: How to use and configure dependency injection in WebFramework.</li> <li>Database Usage: How to interact with the database, including executing queries and managing transactions.</li> <li>Database Migrations: How to manage database schema changes using the DatabaseManager.</li> <li>Entities and Repositories: Understanding the Entity and Repository pattern in WebFramework.</li> <li>Creating New Entities: Step-by-step guide to creating new entities and repositories.</li> <li>Input Validation: How to add input validation to your actions using the InputValidationService.</li> <li>Routing: How to set up and manage routes in your WebFramework application.</li> <li>User Management Flows: Understanding registration, login, password reset, and email change flows.</li> <li>Middleware Management: How to define and use middleware to process requests and responses.</li> <li>Sanity Checks: How to use the sanity check system to ensure your application environment is correct.</li> <li>Tasks: How to create and run tasks from the command line.</li> <li>Templating: How to use the Latte templating engine to render templates.</li> <li>Translations: How to deploy and configure multi-lingual support in your application.</li> <li>Emitting Responses: How to generate responses in actions using the ResponseEmitter or via exceptions.</li> <li>Caching: How to use caching to store and retrieve data efficiently.</li> <li>Queueing: How to queue Jobs and handle them asynchronously.</li> <li>Mailing: How to send emails synchronously or asynchronously using the mail system.</li> <li>Logging: How to configure log channels and route log output.</li> <li>Event Handling: How to trigger and handle Events with EventListeners.</li> <li>Modules: Available installable modules that extend WebFramework functionality.</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<p>To get started with WebFramework, follow the Installation Guide to set up your project. Once installed, explore the documentation to learn how to leverage the full capabilities of WebFramework in your application.</p> <p>For any questions or further assistance, please refer to the documentation or reach out to the WebFramework community.</p> <p>Happy coding!</p>"},{"location":"caching/","title":"Caching","text":"<p>This document provides a guide for developers on how to use caching in the WebFramework. Caching is used to store and retrieve data efficiently, reducing the need for repeated computations or database queries.</p>"},{"location":"caching/#overview","title":"Overview","text":"<p>Caching in WebFramework is managed using the <code>Cache</code> interface, which defines the contract for cache implementations. The framework provides two implementations:</p> <ul> <li>RedisCache: A Redis-based implementation for high-performance caching in the web-framework-redis module.</li> <li>NullCache: A no-op implementation that performs no caching, useful for testing or when caching is disabled.</li> </ul>"},{"location":"caching/#using-caching-in-your-application","title":"Using Caching in Your Application","text":"<p>To use caching in your application, you need to inject the <code>Cache</code> service and use its methods to store and retrieve data.</p>"},{"location":"caching/#example-usage","title":"Example Usage","text":"<pre><code>&lt;?php\nuse WebFramework\\Cache\\Cache;\n\nclass ExampleService\n{\n    public function __construct(\n        private Cache $cache,\n    ) {}\n\n    public function getCachedData(string $key): mixed\n    {\n        if ($this-&gt;cache-&gt;exists($key)) {\n            return $this-&gt;cache-&gt;get($key);\n        }\n\n        // Compute or retrieve the data\n        $data = $this-&gt;computeData();\n\n        // Store the data in the cache\n        $this-&gt;cache-&gt;set($key, $data, 3600); // Cache for 1 hour\n\n        return $data;\n    }\n\n    private function computeData(): mixed\n    {\n        // Perform some computation or data retrieval\n        return 'computed data';\n    }\n}\n</code></pre> <p>In this example, the <code>ExampleService</code> uses the <code>Cache</code> service to check if data is cached, retrieve it if available, or compute and cache it if not.</p>"},{"location":"caching/#enabling-rediscache-in-dependency-injection","title":"Enabling RedisCache in Dependency Injection","text":"<p>To enable <code>RedisCache</code> in your application, you first need to include the <code>web-framework-redis</code> module in your project. Then you need to configure it in your dependency injection container.</p> <p>The easiest way to do this is to add the following entry to your <code>definition_files</code> array in your <code>config.php</code> file, before your application definition file:</p> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '/vendor/avoutic/web-framework/definitions/definitions.php',\n        '/vendor/avoutic/web-framework-redis/definitions/definitions.php',\n        '/definitions/app_definitions.php',\n    ],\n];\n</code></pre> <p>Or you can add the following entry to your application definition file:</p> <pre><code>&lt;?php\n\nreturn [\n    Cache::class =&gt; DI\\autowire(\\WebFramework\\Redis\\RedisCache::class),\n];\n</code></pre>"},{"location":"caching/#providing-an-alternative-caching-implementation","title":"Providing an Alternative Caching Implementation","text":"<p>To provide an alternative caching implementation, you need to create a class that implements the <code>Cache</code> interface. This class should define the methods for storing, retrieving, and invalidating cache items.</p>"},{"location":"caching/#example-custom-cache-implementation","title":"Example Custom Cache Implementation","text":"<pre><code>&lt;?php\n\nnamespace App\\Cache;\n\nuse WebFramework\\Cache\\Cache;\n\nclass CustomCache implements Cache\n{\n    public function exists(string $path): bool\n    {\n        // Check if the item exists in the cache\n    }\n\n    public function get(string $path): mixed\n    {\n        // Retrieve the item from the cache\n    }\n\n    public function set(string $path, mixed $obj, ?int $expiresAfter = null): void\n    {\n        // Store the item in the cache\n    }\n\n    public function setWithTags(string $path, mixed $obj, array $tags, ?int $expiresAfter = null): void\n    {\n        // Store the item in the cache with tags\n    }\n\n    public function invalidate(string $path): void\n    {\n        // Invalidate the cache item\n    }\n\n    public function invalidateTags(array $tags): void\n    {\n        // Invalidate cache items with the given tags\n    }\n\n    public function flush(): void\n    {\n        // Flush the entire cache\n    }\n}\n</code></pre>"},{"location":"caching/#integrating-the-custom-cache","title":"Integrating the Custom Cache","text":"<p>Once you have implemented your custom cache, you need to register it in your dependency injection container.</p> <pre><code>&lt;?php\n\nuse App\\Cache\\CustomCache;\nuse WebFramework\\Cache\\Cache;\n\nreturn [\n    Cache::class =&gt; DI\\autowire(CustomCache::class),\n];\n</code></pre>"},{"location":"configuration/","title":"Configuration Management","text":"<p>This document provides a guide on how to construct the configuration tree for your application and how to access the configuration items from application code.</p>"},{"location":"configuration/#configuration-layering","title":"Configuration Layering","text":"<p>The WebFramework uses a layered approach to configuration, allowing multiple configuration files to be merged to form the final configuration. This is managed by the <code>ConfigBuilder</code> class. The <code>TaskRunner</code> class uses the <code>ConfigBuilder</code> class to build the configuration. So in practice, you don't need to worry about the <code>ConfigBuilder</code> class.</p>"},{"location":"configuration/#environment-variables-and-env-files","title":"Environment Variables and .env Files","text":"<p>Before loading configuration files, the framework automatically loads environment variables from <code>.env</code> files in the following order:</p> <ol> <li><code>.env</code> - Main environment file (should be committed to version control with default values)</li> <li><code>.env.local</code> - Local overrides (should be gitignored and contain local/sensitive values)</li> </ol> <p>Environment variables take precedence over .env files, and .env.local takes precedence over .env. This allows for flexible configuration management across different environments.</p>"},{"location":"configuration/#default-configuration-files","title":"Default Configuration Files","text":"<p>The <code>TaskRunner</code> class specifies a default set of configuration files that are used to build the configuration. These files are:</p> <ul> <li><code>/vendor/avoutic/web-framework/config/base_config.php</code></li> <li><code>/config/config.php</code></li> <li><code>?/config/config_local.php</code></li> </ul> <p>The <code>?</code> before a file path indicates that the file is optional. If it exists, it will be included; otherwise, it will be ignored.</p> <p>Meaning that if will load the base configuration file from the WebFramework, then the application configuration file, and finally the local configuration file if it exists.</p>"},{"location":"configuration/#available-configuration-options","title":"Available Configuration Options","text":"<p>For a complete list of all available WebFramework configuration options and their default settings, see <code>config/base_config.php</code>. This file contains all the default configuration values used by the framework, including:</p> <ul> <li>Application settings (debug, production, timezone, etc.)</li> <li>Logging configuration</li> <li>Security settings (authentication, blacklist, encryption keys, etc.)</li> <li>Action configurations (login, password reset, email change, etc.)</li> <li>Middleware configuration</li> <li>Routing configuration</li> <li>Translation settings</li> <li>Mailer configuration</li> <li>And more</li> </ul> <p>When configuring your application, you can override any of these defaults in your <code>config.php</code> or <code>config_local.php</code> files.</p>"},{"location":"configuration/#setting-another-set-of-files","title":"Setting Another Set of Files","text":"<p>To use a different set of configuration files, you can call the <code>setConfigFiles</code> method on the <code>TaskRunner</code> instance, passing an array of file paths.</p> <p>As <code>base_config.php</code> is the base configuration file for the WebFramework, it should always be included.</p>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>&lt;?php\n\n// Rest of the setup code...\n\n$taskRunner = new TaskRunner('/path/to/app');\n$taskRunner-&gt;setConfigFiles([\n    '/config/base_config.php',\n    '/config/custom_env.php',\n    '/config/custom_local.php',\n]);\n$taskRunner-&gt;build();\n</code></pre> <p>In this example, the configuration is built using the specified custom configuration files.</p>"},{"location":"configuration/#configbuilder","title":"ConfigBuilder","text":"<p>The <code>ConfigBuilder</code> class is actually responsible for building and managing the configuration. It allows you to merge multiple configuration files on top of each other. As mentioned earlier, you don't need to worry about the <code>ConfigBuilder</code> class. The <code>TaskRunner</code> class uses it internally to build the configuration.</p>"},{"location":"configuration/#key-methods","title":"Key Methods","text":"<ul> <li><code>mergeConfigOnTop(array $config): void</code>: Merges a configuration array on top of the existing global configuration.</li> <li><code>loadConfigFile(string $configLocation): array</code>: Loads a configuration file and returns its contents as an array.</li> <li><code>buildConfig(array $configs): array</code>: Builds the configuration by merging multiple configuration files. The files are specified in order, and each file is merged on top of the previous ones.</li> </ul>"},{"location":"configuration/#example-usage","title":"Example Usage","text":"<pre><code>&lt;?php\n\n// Rest of the setup code...\n\n$configBuilder = new ConfigBuilder('/path/to/app');\n$finalConfig = $configBuilder-&gt;buildConfig([\n    '/config/default.php',\n    '/config/environment.php',\n    '/config/local.php',\n]);\n</code></pre> <p>In this example, the configuration is built by merging <code>default.php</code>, <code>environment.php</code>, and <code>local.php</code> in that order. Each subsequent file can override values from the previous ones.</p>"},{"location":"configuration/#configuration-file-format","title":"Configuration File Format","text":"<p>Configuration files are PHP files that return an associative array. Each file can define any number of configuration settings, which are merged into the final configuration.</p>"},{"location":"configuration/#example-configuration-file","title":"Example Configuration File","text":"<pre><code>&lt;?php\n\nreturn [\n    'service' =&gt; [\n        'host' =&gt; env('SERVICE_HOST', 'localhost'),\n        'username' =&gt; env('SERVICE_USER', 'root'),\n        'password' =&gt; env('SERVICE_PASSWORD', ''),\n    ],\n];\n</code></pre> <p>In this example, the configuration file defines settings for the database connection and application settings.</p>"},{"location":"configuration/#accessing-configuration-items","title":"Accessing Configuration Items","text":"<p>Once the configuration is built, it can be accessed using the <code>ConfigService</code> class. This class provides methods to retrieve configuration values using dot notation.</p>"},{"location":"configuration/#configservice","title":"ConfigService","text":"<p>The <code>ConfigService</code> class provides access to configuration values.</p>"},{"location":"configuration/#key-methods_1","title":"Key Methods","text":"<ul> <li><code>get(string $location = ''): mixed</code>: Retrieves a configuration value by its location using dot notation. If no location is provided, it returns the entire configuration array.</li> </ul>"},{"location":"configuration/#example-usage-with-dependency-injection","title":"Example Usage with Dependency Injection","text":"<p>In a typical application, you would use dependency injection to access the <code>ConfigService</code>. Here's an example of how you might do this in a class:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Config\\ConfigService;\n\nclass ExampleClass\n{\n    public function __construct(\n        private ConfigService $configService,\n    ) {}\n\n    public function getServiceHost(): string\n    {\n        return $this-&gt;configService-&gt;get('service.host');\n    }\n}\n</code></pre> <p>In this example, the <code>ExampleClass</code> receives the <code>ConfigService</code> as a dependency through its constructor. The <code>getServiceHost()</code> method then uses the <code>ConfigService</code> to retrieve the <code>host</code> value from the <code>service</code> configuration.</p>"},{"location":"configuration/#environment-variable-support","title":"Environment Variable Support","text":"<p>The framework supports environment variables for common configuration values. You can use <code>.env</code> files to set these values:</p>"},{"location":"configuration/#service-configuration","title":"Service Configuration","text":"<p>Providing environment variables for the service configuration just defined in the above configuration file.</p> <pre><code>SERVICE_HOST=localhost\nSERVICE_USER=myuser\nSERVICE_PASSWORD=mypassword\n</code></pre>"},{"location":"configuration/#application-settings","title":"Application Settings","text":"<pre><code>DEBUG=true\nPRODUCTION=false\nTIMEZONE=Europe/Amsterdam\n</code></pre>"},{"location":"configuration/#security-settings","title":"Security Settings","text":"<pre><code>HMAC_KEY=your_secure_hmac_key\nCRYPT_KEY=your_secure_crypt_key\nRECAPTCHA_SITE_KEY=your_recaptcha_site_key\nRECAPTCHA_SECRET_KEY=your_recaptcha_secret_key\n</code></pre>"},{"location":"configuration/#auth-configuration-files","title":"Auth Configuration Files","text":"<p>Environment variables can also be used in auth configuration files located in <code>/config/auth/</code>. For example, in <code>db_config.main.php</code>:</p> <pre><code>&lt;?php\n\nreturn [\n    'database_host' =&gt; env('DB_HOST', 'localhost'),\n    'database_user' =&gt; env('DB_USER', ''),\n    'database_password' =&gt; env('DB_PASSWORD', ''),\n    'database_database' =&gt; env('DB_NAME', ''),\n];\n</code></pre>"},{"location":"configuration/#precedence-order","title":"Precedence Order","text":"<p>Configuration values are resolved in the following order (highest to lowest precedence):</p> <ol> <li>System environment variables</li> <li>Relevant <code>.env</code> file depending on <code>APP_ENV</code> (e.g. <code>.env.local</code> or <code>.env.production</code>, and '.env' if no <code>APP_ENV</code> is set or no <code>.env.APP_ENV</code> file exists)</li> <li>Configuration files (by default <code>config_local.php</code> &gt; <code>config.php</code> &gt; <code>base_config.php</code>)</li> </ol> <p>This allows you to override any configuration value at any level while maintaining sensible defaults.</p>"},{"location":"database-migrations/","title":"Database Migrations","text":"<p>This document describes how to manage database migrations in WebFramework using the new timestamp-based migration system introduced in WebFramework v9.</p>"},{"location":"database-migrations/#migration-file-organization","title":"Migration File Organization","text":"<p>Database migration files should be placed in the <code>migrations</code> directory of your application. Each migration file uses a timestamp-based naming convention and has a <code>.php</code> extension. For example:</p> <pre><code>migrations/\n\u251c\u2500\u2500 2025_06_10_120000_create_products.php\n\u251c\u2500\u2500 2025_06_10_130000_add_product_code.php\n\u251c\u2500\u2500 2025_06_10_140000_add_email_verification.php\n\u2514\u2500\u2500 2025_06_10_150000_add_newsletter_preference.php\n</code></pre>"},{"location":"database-migrations/#file-naming-convention","title":"File Naming Convention","text":"<p>Migration files follow the format: <code>YYYY_MM_DD_HHMMSS_description.php</code></p> <ul> <li><code>YYYY_MM_DD_HHMMSS</code>: Timestamp when the migration was created</li> <li><code>description</code>: Brief description of what the migration does (snake_case)</li> <li>Files are executed in chronological order based on the timestamp</li> </ul>"},{"location":"database-migrations/#migration-tracking","title":"Migration Tracking","text":"<p>The system uses a <code>migrations</code> table to track which migrations have been executed, replacing the old version-based system. This table automatically tracks:</p> <ul> <li>Migration filename</li> <li>Migration type (framework or app)</li> <li>Batch number (for rollback grouping)</li> <li>Execution timestamp</li> </ul> <p>No manual version configuration is required in your config files.</p>"},{"location":"database-migrations/#migration-structure","title":"Migration Structure","text":"<p>Each migration file contains both <code>up</code> and <code>down</code> directions for forward and rollback operations:</p> <pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            // Actions to apply the migration\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            // Actions to rollback the migration\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#cli-commands","title":"CLI Commands","text":"<p>The new migration system provides several CLI commands for managing migrations:</p>"},{"location":"database-migrations/#run-migrations","title":"Run Migrations","text":"<p>Execute all pending migrations:</p> <pre><code>php Framework db:migrate\n</code></pre> <p>Options: - <code>--dry-run</code> or <code>-d</code>: Preview what would be executed without making changes - <code>--framework</code> or <code>-f</code>: Run only framework migrations</p>"},{"location":"database-migrations/#check-migration-status","title":"Check Migration Status","text":"<p>View the status of all migrations:</p> <pre><code>php Framework db:status\n</code></pre> <p>This shows executed and pending migrations for both framework and application code.</p>"},{"location":"database-migrations/#generate-new-migration","title":"Generate New Migration","text":"<p>Create a new migration file with the correct timestamp format:</p> <pre><code>php Framework db:make create_products_table\n</code></pre> <p>This generates a file like <code>2025_06_10_120000_create_products_table.php</code> with the basic up/down structure.</p>"},{"location":"database-migrations/#migrate-from-legacy-system","title":"Migrate from Legacy System","text":"<p>If upgrading from the old numbered migration system, use:</p> <pre><code>php Framework db:migrate-from-scheme\n</code></pre> <p>This registers existing migrations as \"already executed\" to prevent re-application.</p>"},{"location":"database-migrations/#migration-from-legacy-system","title":"Migration from Legacy System","text":"<p>If you're upgrading from the old <code>db_scheme</code> numbered migration system:</p> <ol> <li>Run the migration command as a developer: <code>php Framework db:convert-from-scheme</code></li> <li>Remove old system: Move <code>db_scheme</code> to <code>db_scheme_old</code> or remove it entirely</li> <li>Remove config: Delete <code>versions.required_app_db</code> from your config</li> <li>Verify database: Ensure all required tables exist and are correct. This conversion assumes you had WebFramework 8 compatible tables before running the command.</li> </ol>"},{"location":"database-migrations/#migration-actions","title":"Migration Actions","text":"<p>The DatabaseManager supports various actions for modifying the database schema. Here are all the supported actions:</p>"},{"location":"database-migrations/#create-table","title":"Create Table","text":"<p>Creates a new table in the database.</p>"},{"location":"database-migrations/#fields","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"create_table\"</li> <li><code>table_name</code> (required): The name of the table to create</li> <li><code>fields</code> (required): An array of field definitions</li> <li><code>constraints</code> (required): An array of constraint definitions</li> </ul>"},{"location":"database-migrations/#field-definition","title":"Field Definition","text":"<p>Each field definition is an associative array that can include the following keys:</p> <ul> <li><code>name</code> (required): The name of the field</li> <li><code>type</code> (required): The data type of the field. Common types include:</li> <li>String types (require quotes for default values):<ul> <li><code>varchar</code>: Variable-length string (requires size)</li> <li><code>char</code>: Fixed-length string (requires size)</li> <li><code>text</code>: Text field</li> <li><code>tinytext</code>: Small text field</li> <li><code>mediumtext</code>: Medium text field</li> <li><code>longtext</code>: Large text field</li> <li><code>enum</code>: Enumerated values</li> <li><code>set</code>: Set of values</li> <li><code>json</code>: JSON data</li> </ul> </li> <li>Binary types (require quotes for default values):<ul> <li><code>binary</code>: Fixed-length binary (requires size)</li> <li><code>varbinary</code>: Variable-length binary (requires size)</li> <li><code>blob</code>: Binary large object</li> <li><code>tinyblob</code>: Small binary large object</li> <li><code>mediumblob</code>: Medium binary large object</li> <li><code>longblob</code>: Large binary large object</li> </ul> </li> <li>Date/Time types (require quotes for default values unless using functions):<ul> <li><code>datetime</code>: Date and time</li> <li><code>timestamp</code>: Timestamp</li> <li><code>date</code>: Date</li> <li><code>time</code>: Time</li> </ul> </li> <li>Numeric types (no quotes for default values):<ul> <li><code>int</code>: Integer (optional size)</li> <li><code>tinyint</code>: Small integer (optional size)</li> <li><code>smallint</code>: Small integer (optional size)</li> <li><code>mediumint</code>: Medium integer (optional size)</li> <li><code>bigint</code>: Large integer (optional size)</li> <li><code>decimal</code>: Decimal number (optional size)</li> <li><code>numeric</code>: Numeric value (optional size)</li> <li><code>float</code>: Floating point number</li> <li><code>double</code>: Double precision number</li> </ul> </li> <li>Special types:<ul> <li><code>foreign_key</code>: Foreign key reference</li> </ul> </li> <li><code>size</code> (required/optional): The size or length of the field:</li> <li>Required for: varchar, char, binary, varbinary</li> <li>Optional for: int, tinyint, smallint, mediumint, bigint, decimal, numeric</li> <li>Not used for: text, datetime, timestamp, date, time, json</li> <li><code>null</code> (optional): If a field can be NULL (default: false)</li> <li><code>default</code> (optional): The default value for the field. Can be either:</li> <li>A string or number value: Will be quoted automatically based on the field type</li> <li>An array with a 'function' key: The value will be used as-is without quotes as a SQL function</li> </ul>"},{"location":"database-migrations/#constraint-definition","title":"Constraint Definition","text":"<p>Each constraint definition is an associative array that can include the following keys:</p> <ul> <li><code>type</code> (required): The type of constraint. Common types include:</li> <li><code>unique</code>: Unique constraint</li> <li><code>index</code>: Index constraint</li> <li><code>name</code> (optional): The name of the constraint.</li> <li><code>values</code> (required): The values to use for the constraint.</li> <li>For <code>unique</code> constraints, this is an array of field names.</li> <li>For <code>index</code> constraints, this is an array of field names.</li> </ul>"},{"location":"database-migrations/#example","title":"Example","text":""},{"location":"database-migrations/#example-with-various-types-and-defaults","title":"Example with Various Types and Defaults","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'create_table',\n                'table_name' =&gt; 'items',\n                'fields' =&gt; [\n                    [\n                        'name' =&gt; 'name',\n                        'type' =&gt; 'varchar',\n                        'size' =&gt; 255,\n                        'default' =&gt; 'Unnamed Item',  // Will be: DEFAULT 'Unnamed Item'\n                    ],\n                    [\n                        'name' =&gt; 'created_at',\n                        'type' =&gt; 'datetime',\n                        'default' =&gt; ['function' =&gt; 'CURRENT_TIMESTAMP'],  // Will be: DEFAULT CURRENT_TIMESTAMP\n                    ],\n                    [\n                        'name' =&gt; 'status',\n                        'type' =&gt; 'enum',\n                        'default' =&gt; 'pending',  // Will be: DEFAULT 'pending'\n                    ],\n                    [\n                        'name' =&gt; 'count',\n                        'type' =&gt; 'int',\n                        'default' =&gt; 0,  // Will be: DEFAULT 0\n                    ],\n                    [\n                        'name' =&gt; 'identifier',\n                        'type' =&gt; 'varchar'\n                        'size' =&gt; 255,\n                        'null' =&gt; true,\n                    ]\n                    [\n                        'name' =&gt; 'metadata',\n                        'type' =&gt; 'json',\n                        'default' =&gt; '{}',  // Will be: DEFAULT '{}'\n                    ],\n                    [\n                        'name' =&gt; 'type_id',\n                        'type' =&gt; 'foreign_key',\n                        'foreign_table' =&gt; 'item_types',\n                        'foreign_field' =&gt; 'id',\n                        'on_delete' =&gt; 'SET NULL',\n                        'on_update' =&gt; 'CASCADE',\n                    ],\n                ],\n                'constraints' =&gt; [\n                    [\n                        'type' =&gt; 'unique',\n                        'values' =&gt; ['name'],\n                    ],\n                    [\n                        'type' =&gt; 'unique',\n                        'name' =&gt; 'item_uniq_identifier',\n                        'values' =&gt; ['identifier'],\n                    ],\n                    [\n                        'type' =&gt; 'index',\n                        'name' =&gt; 'item_idx_identifier',\n                        'values' =&gt; ['identifier']\n                    ],\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'DROP TABLE IF EXISTS `items`',\n                'params' =&gt; [],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#create-trigger","title":"Create Trigger","text":"<p>Creates a new trigger in the database.</p>"},{"location":"database-migrations/#fields_1","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"create_trigger\"</li> <li><code>table_name</code> (required): The name of the table for the trigger</li> <li><code>trigger</code> (required): An array containing trigger details</li> <li><code>name</code> (required): The name of the trigger</li> <li><code>time</code> (required): The trigger time (BEFORE or AFTER)</li> <li><code>event</code> (required): The trigger event (INSERT, UPDATE, or DELETE)</li> <li><code>action</code> (required): The SQL statement to execute when the trigger fires</li> </ul>"},{"location":"database-migrations/#example_1","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'create_trigger',\n                'table_name' =&gt; 'users',\n                'trigger' =&gt; [\n                    'name' =&gt; 'update_last_modified',\n                    'time' =&gt; 'BEFORE',\n                    'event' =&gt; 'UPDATE',\n                    'action' =&gt; 'SET NEW.updated_at = CURRENT_TIMESTAMP',\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'DROP TRIGGER IF EXISTS `update_last_modified`',\n                'params' =&gt; [],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#add-column","title":"Add Column","text":"<p>Adds a new column to an existing table.</p>"},{"location":"database-migrations/#fields_2","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"add_column\"</li> <li><code>table_name</code> (required): The name of the table to alter</li> <li><code>field</code> (required): An array containing the new column details</li> </ul>"},{"location":"database-migrations/#example_2","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'add_column',\n                'table_name' =&gt; 'users',\n                'field' =&gt; [\n                    'name' =&gt; 'last_login',\n                    'type' =&gt; 'datetime',\n                    'null' =&gt; true,\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'ALTER TABLE `users` DROP COLUMN `last_login`',\n                'params' =&gt; [],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#add-constraint","title":"Add Constraint","text":"<p>Adds a new constraint to an existing table.</p>"},{"location":"database-migrations/#fields_3","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"add_constraint\"</li> <li><code>table_name</code> (required): The name of the table to alter</li> <li><code>constraint</code> (required): An array containing the constraint details</li> </ul>"},{"location":"database-migrations/#example_3","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'add_constraint',\n                'table_name' =&gt; 'users',\n                'constraint' =&gt; [\n                    'type' =&gt; 'unique',\n                    'name' =&gt; 'user_uniq_username_email',\n                    'values' =&gt; ['username', 'email'],\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'ALTER TABLE `users` DROP INDEX `user_uniq_username_email`',\n                'params' =&gt; [],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#insert-row","title":"Insert Row","text":"<p>Inserts a new row into a table.</p>"},{"location":"database-migrations/#fields_4","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"insert_row\"</li> <li><code>table_name</code> (required): The name of the table to insert into</li> <li><code>values</code> (required): An array of column-value pairs to insert</li> </ul>"},{"location":"database-migrations/#example_4","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'insert_row',\n                'table_name' =&gt; 'users',\n                'values' =&gt; [\n                    'username' =&gt; 'admin',\n                    'email' =&gt; 'admin@example.com',\n                    'created_at' =&gt; '2023-04-01 00:00:00',\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'DELETE FROM `users` WHERE `username` = ?',\n                'params' =&gt; ['admin'],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#modify-column-type","title":"Modify Column Type","text":"<p>Modifies the type or attributes of an existing column.</p>"},{"location":"database-migrations/#fields_5","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"modify_column_type\"</li> <li><code>table_name</code> (required): The name of the table to alter</li> <li><code>field</code> (required): An array containing the modified column details</li> </ul>"},{"location":"database-migrations/#example_5","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'modify_column_type',\n                'table_name' =&gt; 'users',\n                'field' =&gt; [\n                    'name' =&gt; 'username',\n                    'type' =&gt; 'varchar',\n                    'size' =&gt; 100,\n                    'null' =&gt; false,\n                ],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'modify_column_type',\n                'table_name' =&gt; 'users',\n                'field' =&gt; [\n                    'name' =&gt; 'username',\n                    'type' =&gt; 'varchar',\n                    'size' =&gt; 255,\n                    'null' =&gt; false,\n                ],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#rename-column","title":"Rename Column","text":"<p>Renames an existing column in a table.</p>"},{"location":"database-migrations/#fields_6","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"rename_column\"</li> <li><code>table_name</code> (required): The name of the table to alter</li> <li><code>name</code> (required): The current name of the column</li> <li><code>new_name</code> (required): The new name for the column</li> </ul>"},{"location":"database-migrations/#example_6","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'rename_column',\n                'table_name' =&gt; 'users',\n                'name' =&gt; 'email',\n                'new_name' =&gt; 'user_email',\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'rename_column',\n                'table_name' =&gt; 'users',\n                'name' =&gt; 'user_email',\n                'new_name' =&gt; 'email',\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#rename-table","title":"Rename Table","text":"<p>Renames an existing table.</p>"},{"location":"database-migrations/#fields_7","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"rename_table\"</li> <li><code>table_name</code> (required): The current name of the table</li> <li><code>new_name</code> (required): The new name for the table</li> </ul>"},{"location":"database-migrations/#example_7","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'rename_table',\n                'table_name' =&gt; 'users',\n                'new_name' =&gt; 'app_users',\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'rename_table',\n                'table_name' =&gt; 'app_users',\n                'new_name' =&gt; 'users',\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#raw-query","title":"Raw Query","text":"<p>Executes a raw SQL query.</p>"},{"location":"database-migrations/#fields_8","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"raw_query\"</li> <li><code>query</code> (required): The raw SQL query to execute</li> <li><code>params</code> (required): An array of parameters for the query (can be empty)</li> </ul>"},{"location":"database-migrations/#example_8","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'UPDATE users SET status = ? WHERE last_login &lt; ?',\n                'params' =&gt; ['inactive', '2023-01-01 00:00:00'],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'UPDATE users SET status = ? WHERE status = ?',\n                'params' =&gt; ['active', 'inactive'],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"database-migrations/#run-task","title":"Run Task","text":"<p>Executes a custom task defined in a separate class.</p>"},{"location":"database-migrations/#fields_9","title":"Fields","text":"<ul> <li><code>type</code> (required): Must be \"run_task\"</li> <li><code>task</code> (required): The fully qualified class name of the task to run</li> </ul>"},{"location":"database-migrations/#example_9","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'run_task',\n                'task' =&gt; 'App\\Tasks\\CustomMigrationTask',\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'run_task',\n                'task' =&gt; 'App\\Tasks\\ReverseCustomMigrationTask',\n            ],\n        ],\n    ],\n];\n</code></pre> <p>Note: The custom task class must implement the <code>Task</code> and be registered in the dependency injection container.</p>"},{"location":"database/","title":"Database Usage","text":"<p>This document provides a guide for developers on how to use the database in the WebFramework. It covers the basic operations, including executing queries, inserting data, and managing transactions.</p> <p>In most cases, you should use Entities and Repositories to interact with the database. But there are multiple cases where you might want to interact with the database directly.</p>"},{"location":"database/#overview","title":"Overview","text":"<p>The WebFramework uses the <code>Database</code> interface to define the contract for database operations. The default implementation is <code>MysqliDatabase</code>, which uses the MySQLi extension to interact with a MySQL database.</p> <p>Most interactions with the database are done via Entity Repositories. But there are multiple cases where you might want to interact with the database directly.</p>"},{"location":"database/#executing-queries","title":"Executing Queries","text":"<p>To execute a query, you use the <code>query()</code> method. This method is used for executing SELECT, UPDATE, DELETE, and other non-insert queries.</p>"},{"location":"database/#example-executing-a-query","title":"Example: Executing a Query","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Database\\Database;\n\nclass ExampleService\n{\n    public function __construct(\n        private Database $database,\n    ) {}\n\n    public function listActiveUsers(): void\n    {\n        $query = 'SELECT * FROM users WHERE active = ?';\n        $params = [1];\n\n        $result = $this-&gt;database-&gt;query($query, $params);\n\n        foreach ($result as $row) {\n            echo $row['username'] . ' - ' . $row['email'] . PHP_EOL;\n        }\n    }\n}\n</code></pre> <p>In this example, the <code>ExampleService</code> uses the <code>query()</code> method to retrieve all active users from the <code>users</code> table.</p>"},{"location":"database/#inserting-data","title":"Inserting Data","text":"<p>To insert data into the database, you use the <code>insertQuery()</code> method. This method executes an INSERT query and returns the ID of the last inserted row.</p>"},{"location":"database/#example-inserting-data","title":"Example: Inserting Data","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Database\\Database;\n\nclass UserService\n{\n    public function __construct(\n        private Database $database,\n    ) {}\n\n    public function addUser(string $username, string $email): int\n    {\n        $query = 'INSERT INTO users (username, email) VALUES (?, ?)';\n        $params = [$username, $email];\n\n        return $this-&gt;database-&gt;insertQuery($query, $params);\n    }\n}\n</code></pre> <p>In this example, the <code>UserService</code> uses the <code>insertQuery()</code> method to add a new user to the <code>users</code> table and returns the new user's ID.</p>"},{"location":"database/#managing-transactions","title":"Managing Transactions","text":"<p>Transactions are used to ensure that a series of database operations are executed atomically. You can start a transaction using the <code>startTransaction()</code> method and commit it using the <code>commitTransaction()</code> method.</p>"},{"location":"database/#example-using-transactions","title":"Example: Using Transactions","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Database\\Database;\n\nclass OrderService\n{\n    public function __construct(\n        private Database $database,\n    ) {}\n\n    public function placeOrder(array $orderData): void\n    {\n        $this-&gt;database-&gt;startTransaction();\n\n        try {\n            // Insert order\n            $orderId = $this-&gt;database-&gt;insertQuery('INSERT INTO orders (customer_id, total) VALUES (?, ?)', [\n                $orderData['customer_id'],\n                $orderData['total'],\n            ]);\n\n            // Insert order items\n            foreach ($orderData['items'] as $item) {\n                $this-&gt;database-&gt;insertQuery('INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)', [\n                    $orderId,\n                    $item['product_id'],\n                    $item['quantity'],\n                ]);\n            }\n\n            // Commit transaction\n            $this-&gt;database-&gt;commitTransaction();\n        } catch (\\Exception $e) {\n            // Rollback transaction on error\n            $this-&gt;database-&gt;rollbackTransaction();\n            throw $e;\n        }\n    }\n}\n</code></pre> <p>In this example, the <code>OrderService</code> uses a transaction to ensure that both the order and its items are inserted into the database atomically. If an error occurs, the transaction is rolled back.</p>"},{"location":"dependency-injection/","title":"Dependency Injection","text":"<p>This document provides a guide for developers on how to use and configure dependency injection in the WebFramework. The framework uses PHP-DI for managing dependencies, allowing you to define and override services and classes in a flexible manner.</p>"},{"location":"dependency-injection/#overview","title":"Overview","text":"<p>Dependency injection in WebFramework is managed using PHP-DI, a powerful dependency injection container for PHP. It allows you to define how classes and services are instantiated and configured, making it easy to manage dependencies across your application.</p> <p>The <code>BootstrapService</code> and <code>SlimAppTask</code> classes are responsible for setting up the dependency injection container and registering services. They use the configured definition files to do this.</p>"},{"location":"dependency-injection/#default-definition-files","title":"Default Definition Files","text":"<p>The base configuration specifies a default set of definition files that are used for dependency injection. These files are:</p> <ul> <li><code>/vendor/avoutic/web-framework/definitions/definitions.php</code></li> <li><code>/definitions/app_definitions.php</code></li> </ul> <p>Meaning that if will load the base definition file from the WebFramework, then the application definition file.</p>"},{"location":"dependency-injection/#setting-another-set-of-files","title":"Setting Another Set of Files","text":"<p>To set your own definition files, you need to specify them in the <code>base_config.php</code> file under the <code>definition_files</code> key. These files contain PHP-DI definitions that configure how services and classes are instantiated.</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p> <p>If the file starts with a <code>?</code>, it will be ignored if it does not exist. This is useful for local configuration files that you don't want to commit to version control.</p>"},{"location":"dependency-injection/#example-configuration","title":"Example Configuration","text":"<pre><code>&lt;?php\n\nreturn [\n    // Other configuration settings...\n\n    'definition_files' =&gt; [\n        '/vendor/avoutic/web-framework/definitions/definitions.php',\n        '/definitions/my_definitions.php', // Your custom definitions\n        '?/definitions/local_definitions.php', // Local definitions that are not committed\n    ],\n];\n</code></pre> <p>In this example, <code>my_definitions.php</code> is a custom definition file that you can use to define your own services and override existing ones.</p>"},{"location":"dependency-injection/#overriding-classes","title":"Overriding Classes","text":"<p>To override a class like <code>Instrumentation</code>, you need to provide a new implementation in your definition file. This is done using PHP-DI's <code>autowire</code> and <code>constructor</code> methods.</p>"},{"location":"dependency-injection/#example-overriding-instrumentation","title":"Example: Overriding Instrumentation","text":"<p>Suppose you want to replace the default <code>Instrumentation</code> implementation with a custom one. You can do this by adding the following entry to your definition file:</p> <pre><code>&lt;?php\n\nuse App\\Instrumentation\\CustomInstrumentation;\nuse WebFramework\\Diagnostics\\Instrumentation;\n\nreturn [\n    Instrumentation::class =&gt; DI\\autowire(CustomInstrumentation::class),\n];\n</code></pre> <p>In this example, <code>CustomInstrumentation</code> is a class that implements the <code>Instrumentation</code> interface. By using <code>DI\\autowire</code>, PHP-DI will automatically inject dependencies into the <code>CustomInstrumentation</code> class.</p> <p>For more information on PHP-DI, see the PHP-DI documentation.</p>"},{"location":"emitting-responses/","title":"Emitting Responses","text":"<p>This document provides a guide for developers on how to generate responses in an Action using the <code>ResponseEmitter</code> or via exceptions through the <code>ErrorRedirectMiddleware</code>. It also covers how to build redirects programmatically.</p>"},{"location":"emitting-responses/#generating-responses-in-an-action","title":"Generating Responses in an Action","text":"<p>In WebFramework, responses can be generated directly using the <code>ResponseEmitter</code> or indirectly by throwing exceptions that are handled by the <code>ErrorRedirectMiddleware</code>.</p>"},{"location":"emitting-responses/#using-responseemitter","title":"Using ResponseEmitter","text":"<p>The <code>ResponseEmitter</code> class provides methods to generate various types of responses, such as redirects, errors, and standard HTTP responses.</p>"},{"location":"emitting-responses/#example-generating-a-redirect-response","title":"Example: Generating a Redirect Response","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Http\\ResponseEmitter;\n\nclass ExampleAction\n{\n    public function __construct(\n        private ResponseEmitter $responseEmitter,\n    ) {}\n\n    public function __invoke(): ResponseInterface\n    {\n        return $this-&gt;responseEmitter-&gt;redirect('/home');\n    }\n}\n</code></pre>"},{"location":"emitting-responses/#using-exceptions","title":"Using Exceptions","text":"<p>Exceptions can be thrown in an Action or Service class to trigger specific responses. The <code>ErrorRedirectMiddleware</code> (assuming it is enabled) handles these exceptions and generates the appropriate HTTP response.</p>"},{"location":"emitting-responses/#exceptions-handled-by-errorredirectmiddleware","title":"Exceptions Handled by ErrorRedirectMiddleware","text":"<ul> <li>RedirectException: Triggers a redirect to a specified URL.</li> <li> <p>HTTP Code: 302 (Found)</p> </li> <li> <p>HttpForbiddenException: Indicates that access to the requested resource is forbidden.</p> </li> <li> <p>HTTP Code: 403 (Forbidden)</p> </li> <li> <p>HttpNotFoundException: Indicates that the requested resource was not found.</p> </li> <li> <p>HTTP Code: 404 (Not Found)</p> </li> <li> <p>HttpUnauthorizedException: Indicates that authentication is required to access the resource.</p> </li> <li> <p>HTTP Code: 401 (Unauthorized)</p> </li> <li> <p>BlacklistException: Indicates that the user is blacklisted.</p> </li> <li> <p>HTTP Code: 403 (Forbidden)</p> </li> <li> <p>Throwable: Any other unhandled exception results in a generic error response.</p> </li> <li>HTTP Code: 500 (Internal Server Error)</li> </ul>"},{"location":"emitting-responses/#error-handlers","title":"Error Handlers","text":"<p>The <code>ResponseEmitter</code> uses configurable error handlers to generate custom error pages for various HTTP error codes. Error handlers allow you to provide user-friendly error pages instead of the default simple text responses.</p>"},{"location":"emitting-responses/#configuration","title":"Configuration","text":"<p>Error handlers are configured in your configuration file under the <code>error_handlers</code> key. Each error handler should be set to a fully qualified class name of an action class that can be resolved by the dependency injection container.</p> <pre><code>&lt;?php\n\nreturn [\n    'error_handlers' =&gt; [\n        '403' =&gt; \\App\\Actions\\Error403::class,\n        '404' =&gt; \\App\\Actions\\Error404::class,\n        '405' =&gt; \\App\\Actions\\Error405::class,\n        '500' =&gt; \\App\\Actions\\Error500::class,\n        'blacklisted' =&gt; \\App\\Actions\\Blacklisted::class,\n    ],\n];\n</code></pre>"},{"location":"emitting-responses/#available-error-handlers","title":"Available Error Handlers","text":"<p>The following error handlers can be configured:</p> <ul> <li><code>403</code>: Handles forbidden access errors (HTTP 403 Forbidden)</li> <li><code>404</code>: Handles not found errors (HTTP 404 Not Found)</li> <li><code>405</code>: Handles method not allowed errors (HTTP 405 Method Not Allowed)</li> <li><code>500</code>: Handles internal server errors (HTTP 500 Internal Server Error)</li> <li><code>blacklisted</code>: Handles blacklisted user access (HTTP 403 Forbidden)</li> </ul>"},{"location":"emitting-responses/#error-handler-implementation","title":"Error Handler Implementation","text":"<p>Error handler classes must be callable (implement <code>__invoke</code>) and accept two parameters: 1. <code>Request</code> - The PSR-7 server request object 2. <code>Response</code> - The PSR-7 response object (pre-configured with the appropriate status code)</p> <p>The error handler should return a <code>ResponseInterface</code> with the rendered error page.</p>"},{"location":"emitting-responses/#example-creating-a-404-error-handler","title":"Example: Creating a 404 Error Handler","text":"<pre><code>&lt;?php\n\nnamespace App\\Actions;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface as Request;\nuse Slim\\Http\\Response;\nuse WebFramework\\Presentation\\RenderService;\n\nclass Error404\n{\n    public function __construct(\n        private RenderService $renderer,\n    ) {}\n\n    public function __invoke(Request $request, Response $response): ResponseInterface\n    {\n        return $this-&gt;renderer-&gt;render($request, $response, 'errors/404.latte', [\n            'title' =&gt; 'Page Not Found',\n            'message' =&gt; 'The page you are looking for could not be found.',\n        ]);\n    }\n}\n</code></pre>"},{"location":"emitting-responses/#example-creating-a-500-error-handler","title":"Example: Creating a 500 Error Handler","text":"<pre><code>&lt;?php\n\nnamespace App\\Actions;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface as Request;\nuse Slim\\Http\\Response;\nuse WebFramework\\Presentation\\RenderService;\n\nclass Error500\n{\n    public function __construct(\n        private RenderService $renderer,\n    ) {}\n\n    public function __invoke(Request $request, Response $response): ResponseInterface\n    {\n        // Access error report if available\n        $errorReport = $request-&gt;getAttribute('error_report');\n\n        return $this-&gt;renderer-&gt;render($request, $response, 'errors/500.latte', [\n            'title' =&gt; 'Internal Server Error',\n            'message' =&gt; 'An error occurred while processing your request.',\n            'errorReport' =&gt; $errorReport,\n        ]);\n    }\n}\n</code></pre>"},{"location":"emitting-responses/#error-handler-behavior","title":"Error Handler Behavior","text":"<p>Error handlers are only invoked for non-JSON requests. When a request has <code>Content-Type: application/json</code>, the <code>ResponseEmitter</code> automatically returns a JSON response instead of calling the error handler.</p> <p>If an error handler is not configured (set to <code>null</code>) or cannot be resolved from the container, the <code>ResponseEmitter</code> falls back to a simple text response:</p> <ul> <li>403: \"Forbidden\"</li> <li>404: \"Not Found\"</li> <li>405: \"Method Not Allowed\"</li> <li>500: \"Error: {details}\" (includes error title and details)</li> <li>blacklisted: \"Blacklisted\"</li> </ul>"},{"location":"emitting-responses/#error-report-attribute","title":"Error Report Attribute","text":"<p>For 500 errors, the request may include an <code>error_report</code> attribute (set by <code>ErrorRedirectMiddleware</code>) that contains detailed error information. This can be accessed in your error handler:</p> <pre><code>$errorReport = $request-&gt;getAttribute('error_report');\nif ($errorReport) {\n    // Use error report for debugging or logging\n}\n</code></pre>"},{"location":"emitting-responses/#building-redirects-programmatically","title":"Building Redirects Programmatically","text":"<p>The <code>ResponseEmitter</code> service provides methods to build and generate redirect responses programmatically. This allows you to construct redirects with dynamic parameters and query strings.</p>"},{"location":"emitting-responses/#example-building-a-simple-redirect","title":"Example: Building a Simple Redirect","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Http\\ResponseEmitter;\n\nclass ExampleService\n{\n    public function __construct(\n        private ResponseEmitter $responseEmitter,\n    ) {}\n\n    public function redirectToHome(): ResponseInterface\n    {\n        return $this-&gt;responseEmitter-&gt;redirect('/home');\n    }\n}\n</code></pre>"},{"location":"emitting-responses/#example-building-a-programmatic-redirect","title":"Example: Building a Programmatic Redirect","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Http\\ResponseEmitter;\n\nclass ExampleService\n{\n    public function __construct(\n        private ResponseEmitter $responseEmitter,\n    ) {}\n\n    public function redirectToUserProfile(int $userId): ResponseInterface\n    {\n        return $this-&gt;responseEmitter-&gt;redirect('/user/{id}', ['id' =&gt; $userId]);\n    }\n}\n</code></pre>"},{"location":"emitting-responses/#example-building-a-redirect-with-query-parameters","title":"Example: Building a Redirect with Query Parameters","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Http\\ResponseEmitter;\n\nclass ExampleService\n{\n    public function __construct(\n        private ResponseEmitter $responseEmitter,\n    ) {}\n\n    public function redirectToSearch(string $query): ResponseInterface\n    {\n        return $this-&gt;responseEmitter-&gt;buildQueryRedirect('/search', [], ['q' =&gt; $query]);\n    }\n}\n</code></pre> <p>In these examples, the <code>ResponseEmitter</code> is used to construct redirect responses with dynamic path parameters and query strings.</p>"},{"location":"entities-and-repositories/","title":"Entities and Repositories","text":"<p>This document provides a guide for developers on the Entity and Repository pattern used in the WebFramework. This pattern is used to separate the concerns of data representation and data persistence, making your application more modular and maintainable.</p>"},{"location":"entities-and-repositories/#overview","title":"Overview","text":"<p>In the WebFramework, entities are objects that represent data in your application. They are responsible for holding data and providing methods to access and manipulate that data. Repositories, on the other hand, are responsible for persisting entities to the database and retrieving them.</p>"},{"location":"entities-and-repositories/#entities","title":"Entities","text":"<p>Entities are classes that extend <code>EntityCore</code>. They define the properties and methods for accessing and manipulating data. Entities should not contain any business logic; they are purely for data representation.</p>"},{"location":"entities-and-repositories/#repositories","title":"Repositories","text":"<p>Repositories are classes that extend <code>RepositoryCore</code>. They provide methods for storing, retrieving, and updating entities in the database. Repositories handle the database interactions, allowing entities to remain focused on data representation.</p> <p>How to create new entities and repositories is described in the New Entity and Repository Generation document.</p>"},{"location":"entities-and-repositories/#retrieving-entities-with-a-repository","title":"Retrieving Entities with a Repository","text":"<p>Repositories provide several methods for retrieving entities from the database. Some methods return single entities, while others return <code>EntityCollection</code> objects.</p>"},{"location":"entities-and-repositories/#single-entity-methods","title":"Single Entity Methods","text":"<p>These methods return either a single entity or null:</p>"},{"location":"entities-and-repositories/#by-id","title":"By ID","text":"<pre><code>&lt;?php\n\n$user = $userRepository-&gt;getObjectById($userId);  // Returns User|null\n</code></pre>"},{"location":"entities-and-repositories/#by-filter","title":"By Filter","text":"<p>This method takes a single filter as an array. If multiple objects are found, the function will throw an exception.</p> <pre><code>&lt;?php\n\n$user = $userRepository-&gt;getObject(['email' =&gt; $email]);  // Returns User|null\n</code></pre>"},{"location":"entities-and-repositories/#collection-methods","title":"Collection Methods","text":"<p>These methods return an <code>EntityCollection</code> object:</p>"},{"location":"entities-and-repositories/#multiple-entities","title":"Multiple Entities","text":"<p>To retrieve multiple entities, you can use the <code>getObjects</code> method. This method takes the following parameters:</p> <ul> <li><code>offset</code>: The offset of the first entity to retrieve.</li> <li><code>limit</code>: The number of entities to retrieve (-1 for all).</li> <li><code>filter</code>: An array of filter conditions.</li> <li><code>order</code>: The order by clause.</li> </ul> <p>The filter is a key-value pair array where the key is the field name and the value is the value to filter by. Each key-value pair being a filter condition. The key is always a field name and the value is the value to filter by. The value can be a string, a number, boolean, null, or an array for describing an operator other than equals.</p> <pre><code>&lt;?php\n\n// Returns EntityCollection&lt;User&gt;\n$users = $userRepository-&gt;getObjects(0, 10, [\n        'email' =&gt; $email,\n        'active' =&gt; true,\n        'last_login' =&gt; [ '&gt;', strtotime('-1 month') ],\n    ],\n    'order' =&gt; 'username ASC',\n);\n</code></pre>"},{"location":"entities-and-repositories/#counting-entities-matching-a-filter","title":"Counting Entities matching a filter","text":"<p>You can count the number of entities matching a filter using the <code>countObjects</code> method. This method takes a single filter as an array.</p>"},{"location":"entities-and-repositories/#custom-query","title":"Custom Query","text":"<pre><code>&lt;?php\n\n// Returns EntityCollection&lt;User&gt;\n$query = 'SELECT * FROM users WHERE last_login &gt; ?';\n$params = [strtotime('-1 month')];\n$users = $userRepository-&gt;getFromQuery($query, $params);\n</code></pre>"},{"location":"entities-and-repositories/#working-with-entitycollection","title":"Working with EntityCollection","text":"<p><code>EntityCollection</code> is a specialized class for handling collections of entities. It implements both <code>Iterator</code> and <code>Countable</code> interfaces, providing several advantages over regular arrays:</p>"},{"location":"entities-and-repositories/#key-features","title":"Key Features","text":"<ul> <li>Type-safe iteration over entities</li> <li>Built-in counting functionality</li> <li>Methods for bulk operations</li> <li>Easy conversion to arrays</li> </ul>"},{"location":"entities-and-repositories/#example-usage","title":"Example Usage","text":""},{"location":"entities-and-repositories/#iterating-over-a-collection","title":"Iterating Over a Collection","text":"<pre><code>&lt;?php\n\n$users = $userRepository-&gt;getObjects(0, 10);\nforeach ($users as $user) {\n    echo $user-&gt;getUsername();\n}\n</code></pre>"},{"location":"entities-and-repositories/#counting-entities","title":"Counting Entities","text":"<pre><code>&lt;?php\n\n$userCount = $users-&gt;count();\n</code></pre>"},{"location":"entities-and-repositories/#converting-to-array","title":"Converting to Array","text":"<p>You can convert an EntityCollection to an array in two ways:</p> <ol> <li> <p>Convert to an array of entity arrays: <pre><code>&lt;?php\n\n$arrayOfArrays = $users-&gt;toArray();  // Each entity is converted to array form\n</code></pre></p> </li> <li> <p>Apply a custom callback to each entity: <pre><code>&lt;?php\n\n$usernames = $users-&gt;call(function($user) {\n    return $user-&gt;getUsername();\n});\n</code></pre></p> </li> </ol>"},{"location":"entities-and-repositories/#entitycollection-vs-array","title":"EntityCollection vs Array","text":"<p>Here's why EntityCollection is preferred over regular arrays:</p> <ol> <li>Type Safety: EntityCollection is generic-typed, ensuring all items are of the same entity type</li> <li>Iteration Control: Provides controlled iteration without exposing the underlying array</li> <li>Bulk Operations: Built-in methods for operating on all entities at once</li> <li>Memory Efficiency: Lazy loading capabilities can be implemented without changing the interface</li> <li>Consistency: Ensures consistent behavior across the application</li> </ol>"},{"location":"entities-and-repositories/#example-updating-multiple-entities","title":"Example: Updating Multiple Entities","text":"<p>Here's an example of working with an EntityCollection:</p> <pre><code>&lt;?php\n\nuse App\\Repository\\UserRepository;\n\nclass UserService\n{\n    public function __construct(\n        private UserRepository $userRepository,\n    ) {}\n\n    public function deactivateInactiveUsers(int $daysInactive): void\n    {\n        $query = 'SELECT * FROM users WHERE last_login &lt; ?';\n        $params = [strtotime(\"-{$daysInactive} days\")];\n\n        $inactiveUsers = $this-&gt;userRepository-&gt;getFromQuery($query, $params);\n\n        foreach ($inactiveUsers as $user) {\n            $user-&gt;setActive(false);\n            $this-&gt;userRepository-&gt;save($user);\n        }\n\n        // Or get a count of affected users\n        $affectedCount = $inactiveUsers-&gt;count();\n    }\n}\n</code></pre>"},{"location":"events/","title":"Event System","text":"<p>The WebFramework provides a robust event system that allows for decoupled communication between different parts of your application. This system follows the observer pattern and supports both synchronous and asynchronous event handling.</p>"},{"location":"events/#core-components","title":"Core Components","text":""},{"location":"events/#eventservice","title":"EventService","text":"<p>The <code>EventService</code> is the central manager for all events in the application. It provides methods to:</p> <ul> <li>Register events and their listeners</li> <li>Dispatch events</li> <li>Manage event listeners</li> <li>Handle queued event listeners</li> </ul>"},{"location":"events/#event-interface","title":"Event Interface","text":"<p>Events are simple data containers that implement the <code>Event</code> interface. They should contain only the data needed for the event, not the logic:</p> <pre><code>&lt;?php\n\ninterface Event {}\n</code></pre>"},{"location":"events/#eventlistener-interface","title":"EventListener Interface","text":"<p>Event listeners implement the <code>EventListener</code> interface and contain the actual logic for handling events:</p> <pre><code>&lt;?php\n\ninterface EventListener\n{\n    public function handle(Event $event): bool;\n}\n</code></pre>"},{"location":"events/#queuedeventlistener","title":"QueuedEventListener","text":"<p>The <code>QueuedEventListener</code> abstract class provides a base for event listeners that should be processed asynchronously:</p> <pre><code>&lt;?php\n\nabstract class QueuedEventListener implements EventListener\n{\n    protected string $queueName = 'default';\n\n    public function getQueueName(): string\n    {\n        return $this-&gt;queueName;\n    }\n}\n</code></pre>"},{"location":"events/#usage","title":"Usage","text":""},{"location":"events/#creating-an-event","title":"Creating an Event","text":"<p>An Event should only contain data and no logic. All logic related to an Event should be in a separate EventListener.</p> <pre><code>&lt;?php\n\nclass UserRegisteredEvent implements Event\n{\n    public function __construct(\n        private int $userId,\n        private string $email\n    ) {}\n\n    public function getUserId(): int\n    {\n        return $this-&gt;userId;\n    }\n\n    public function getEmail(): string\n    {\n        return $this-&gt;email;\n    }\n}\n</code></pre>"},{"location":"events/#creating-a-synchronous-event-listener","title":"Creating a Synchronous Event Listener","text":"<pre><code>&lt;?php\n\n/**\n * @implements EventListener&lt;UserRegisteredEvent&gt;\n */\nclass SendWelcomeEmailListener implements EventListener\n{\n    public function handle(Event $event): bool\n    {\n        if (!$event instanceof UserRegisteredEvent) {\n            return false;\n        }\n\n        // Send welcome email logic here\n        return true;\n    }\n}\n</code></pre>"},{"location":"events/#creating-a-queued-event-listener","title":"Creating a Queued Event Listener","text":"<pre><code>&lt;?php\n\n/**\n * @extends QueuedEventListener&lt;UserRegisteredEvent&gt;\n */\nclass ProcessUserDataListener extends QueuedEventListener\n{\n    protected string $queueName = 'user-processing';\n\n    public function handle(Event $event): bool\n    {\n        if (!$event instanceof UserRegisteredEvent) {\n            return false;\n        }\n\n        // Heavy processing logic here\n        return true;\n    }\n}\n</code></pre>"},{"location":"events/#registering-events-and-listeners","title":"Registering Events and Listeners","text":"<pre><code>&lt;?php\n\n// Register an event with its listeners\n$eventService-&gt;registerEvent(\n    UserRegisteredEvent::class,\n    [\n        SendWelcomeEmailListener::class,\n        ProcessUserDataListener::class,\n    ]\n);\n\n// Add a new listener to an existing event\n$eventService-&gt;addListener(\n    UserRegisteredEvent::class,\n    NewFeatureListener::class\n);\n</code></pre>"},{"location":"events/#dispatching-events","title":"Dispatching Events","text":"<pre><code>&lt;?php\n\n$event = new UserRegisteredEvent(123, 'user@example.com');\n$eventService-&gt;dispatch($event);\n</code></pre>"},{"location":"events/#application-integration","title":"Application Integration","text":"<p>Here are real examples from the WebFramework showing how events are used in practice:</p>"},{"location":"events/#user-login-events","title":"User Login Events","text":"<p>When a user successfully logs in, the framework dispatches a <code>UserLoggedIn</code> event:</p> <pre><code>&lt;?php\n\n$this-&gt;authenticationService-&gt;authenticate($user);\n$this-&gt;eventService-&gt;dispatch(new UserLoggedIn($user));\n</code></pre>"},{"location":"events/#password-change-events","title":"Password Change Events","text":"<p>When a user changes their password, a <code>UserPasswordChanged</code> event is dispatched:</p> <pre><code>&lt;?php\n\n$user-&gt;setSolidPassword($newHash);\n$this-&gt;userRepository-&gt;save($user);\n$this-&gt;eventService-&gt;dispatch(new UserPasswordChanged($user));\n</code></pre>"},{"location":"events/#email-change-events","title":"Email Change Events","text":"<p>When a user's email address is changed, a <code>UserEmailChanged</code> event is dispatched:</p> <pre><code>&lt;?php\n\n$user-&gt;setEmail($email);\n$this-&gt;userRepository-&gt;save($user);\n$this-&gt;eventService-&gt;dispatch(new UserEmailChanged($user));\n</code></pre>"},{"location":"events/#user-verification-events","title":"User Verification Events","text":"<p>When a user completes email verification, a <code>UserVerified</code> event is dispatched:</p> <pre><code>&lt;?php\n\n$user-&gt;setVerified();\n$this-&gt;userRepository-&gt;save($user);\n$this-&gt;eventService-&gt;dispatch(new UserVerified($user));\n</code></pre>"},{"location":"events/#queue-setup-for-asynchronous-events","title":"Queue Setup for Asynchronous Events","text":"<p>To use queued event listeners, you must:</p> <ol> <li>Register the EventJobHandler in your application configuration:</li> </ol> <pre><code>&lt;?php\n\n$queueService-&gt;registerJobHandler(EventJob::class, EventJobHandler::class);\n</code></pre> <ol> <li>Run queue workers to process the jobs:</li> </ol> <pre><code>php scripts/framework.php queue:worker\n</code></pre> <ol> <li>Configure queue names in your listeners:</li> </ol> <pre><code>&lt;?php\n\nclass HeavyProcessingListener extends QueuedEventListener\n{\n    protected string $queueName = 'heavy-processing';\n}\n</code></pre> <p>Queued events will only be handled if you have a QueueWorker active and registered the EventJobHandler to handle EventJobs.</p>"},{"location":"events/#framework-events","title":"Framework Events","text":"<p>WebFramework itself will send out the following events:</p> <ul> <li>UserLoggedIn</li> <li>UserPasswordChanged</li> <li>UserVerified</li> <li>UserEmailChanged</li> </ul>"},{"location":"events/#error-handling-debugging","title":"Error Handling &amp; Debugging","text":""},{"location":"events/#unregistered-events","title":"Unregistered Events","text":"<p>If you dispatch an event that hasn't been registered, the EventService will log a debug message and silently continue:</p> <pre><code>// This will log: \"Cannot dispatch unregistered event\"\n$eventService-&gt;dispatch(new UnregisteredEvent());\n</code></pre>"},{"location":"events/#listener-errors","title":"Listener Errors","text":"<p>If a listener throws an exception, it will bubble up and stop processing of subsequent listeners. Wrap listener logic in try-catch blocks for graceful error handling:</p> <pre><code>&lt;?php\n\npublic function handle(Event $event): bool\n{\n    try {\n        // Your event handling logic\n        return true;\n    } catch (\\Exception $e) {\n        $this-&gt;logger-&gt;error('Event handling failed', ['exception' =&gt; $e]);\n        return false;\n    }\n}\n</code></pre>"},{"location":"events/#debugging","title":"Debugging","text":"<p>Enable debug logging to see event dispatch activity: - Synchronous events: \"Dispatching non-queued event\" - Asynchronous events: \"Dispatching queued event\"</p>"},{"location":"events/#performance-considerations","title":"Performance Considerations","text":""},{"location":"events/#synchronous-vs-asynchronous-processing","title":"Synchronous vs Asynchronous Processing","text":"<ul> <li>Use synchronous listeners for lightweight operations that must complete immediately</li> <li>Use <code>QueuedEventListener</code> for heavy operations like email sending, file processing, or external API calls</li> <li>Synchronous listeners block the request until completion</li> <li>Queued listeners are processed asynchronously by queue workers</li> </ul>"},{"location":"events/#queue-configuration","title":"Queue Configuration","text":"<p>For queued events, ensure you have: 1. Queue workers running to process jobs 2. EventJobHandler registered with QueueService 3. Appropriate queue names for different types of processing</p>"},{"location":"events/#testing-event-driven-code","title":"Testing Event-Driven Code","text":""},{"location":"events/#testing-event-dispatch","title":"Testing Event Dispatch","text":"<pre><code>&lt;?php\n\n// Mock the EventService to verify events are dispatched\n$eventService = $this-&gt;createMock(EventService::class);\n$eventService-&gt;expects($this-&gt;once())\n    -&gt;method('dispatch')\n    -&gt;with($this-&gt;isInstanceOf(UserLoggedIn::class));\n</code></pre>"},{"location":"events/#testing-event-listeners","title":"Testing Event Listeners","text":"<pre><code>&lt;?php\n\npublic function testUserLoggedInListener()\n{\n    $user = new User();\n    $event = new UserLoggedIn($user);\n    $listener = new MyEventListener();\n\n    $result = $listener-&gt;handle($event);\n\n    $this-&gt;assertTrue($result);\n}\n</code></pre>"},{"location":"events/#best-practices","title":"Best Practices","text":"<ol> <li>Keep events focused on a single state change</li> <li>Use descriptive event names that reflect past tense (e.g., <code>UserRegisteredEvent</code>)</li> <li>Include only necessary data in events</li> <li>Use queued listeners for time-consuming operations</li> <li>Implement proper error handling in listeners</li> <li>Consider using different queues for different types of listeners</li> <li>Monitor event processing and queue sizes</li> <li>Implement proper logging in event listeners   </li> </ol>"},{"location":"input-validation/","title":"Input Validation","text":"<p>This document provides a guide for developers on how to add input validation to a new action in the WebFramework. It leverages the <code>InputValidationService</code> and various validators to ensure that user input meets the required criteria before processing.</p>"},{"location":"input-validation/#steps-to-add-input-validation","title":"Steps to Add Input Validation","text":""},{"location":"input-validation/#1-define-your-action-class","title":"1. Define Your Action Class","text":"<p>Create a new action class in the <code>actions</code> directory. This class should implement the necessary logic for handling the request and response.</p>"},{"location":"input-validation/#2-inject-dependencies","title":"2. Inject Dependencies","text":"<p>In the constructor of your action class, inject the <code>InputValidationService</code> along with any other services you need. This service will be used to validate the input data.</p> <pre><code>&lt;?php\n\nuse WebFramework\\Validation\\InputValidationService;\n\nclass YourNewAction\n{\n    public function __construct(\n        protected InputValidationService $inputValidationService,\n        // other dependencies...\n    ) {}\n}\n</code></pre>"},{"location":"input-validation/#3-define-validation-rules","title":"3. Define Validation Rules","text":"<p>Inside your action method (usually <code>__invoke</code>), define the validation rules for the input data. Use the appropriate validators for each field. For example, use <code>EmailValidator</code> for email fields, <code>PasswordValidator</code> for password fields, etc.</p> <pre><code>&lt;?php\n\nuse WebFramework\\Validation\\Validator\\EmailValidator;\nuse WebFramework\\Validation\\Validator\\PasswordValidator;\n\n$validators = [\n    'email' =&gt; (new EmailValidator())-&gt;required(),\n    'password' =&gt; new PasswordValidator(),\n];\n</code></pre>"},{"location":"input-validation/#4-validate-input-data","title":"4. Validate Input Data","text":"<p>Use the <code>InputValidationService</code> to validate the input data against the defined rules. Pass the request parameters to the <code>validate</code> method.</p> <pre><code>&lt;?php\n\n$filtered = $this-&gt;inputValidationService-&gt;validate(\n    $validators,\n    $request-&gt;getParams()\n);\n</code></pre>"},{"location":"input-validation/#5-handle-validation-errors","title":"5. Handle Validation Errors","text":"<p>If validation fails, the <code>InputValidationService</code> will throw a <code>MultiValidationException</code>. Catch this exception and handle the errors appropriately, such as by adding error messages to the response.</p> <pre><code>&lt;?php\n\nuse WebFramework\\Exception\\ValidationException;\n\ntry {\n    $filtered = $this-&gt;inputValidationService-&gt;validate(\n        $validators,\n        $request-&gt;getParams()\n    );\n    // Proceed with processing the validated data\n} catch (ValidationException $e) {\n    $this-&gt;messageService-&gt;addErrors($e-&gt;getErrors());\n    // Render the form again with error messages\n}\n</code></pre>"},{"location":"input-validation/#6-process-validated-data","title":"6. Process Validated Data","text":"<p>Once the data is validated, you can safely use the <code>$filtered</code> array to access the validated input values and proceed with your action's logic.</p> <pre><code>&lt;?php\n\n$email = $filtered['email'];\n$password = $filtered['password'];\n\n// Perform actions with validated data\n</code></pre>"},{"location":"input-validation/#example","title":"Example","text":"<p>Here's a simplified example of an action that validates an email and password:</p> <pre><code>&lt;?php\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Slim\\Http\\Response;\nuse Slim\\Http\\ServerRequest as Request;\nuse WebFramework\\Validation\\InputValidationService;\nuse WebFramework\\Validation\\Validator\\EmailValidator;\nuse WebFramework\\Validation\\Validator\\PasswordValidator;\nuse WebFramework\\Exception\\ValidationException;\n\nclass ExampleAction\n{\n    public function __construct(\n        protected InputValidationService $inputValidationService,\n        // other dependencies...\n    ) {}\n\n    public function __invoke(Request $request, Response $response, array $routeArgs): ResponseInterface\n    {\n        $validators = [\n            'email' =&gt; (new EmailValidator())-&gt;required(),\n            'password' =&gt; new PasswordValidator(),\n        ];\n\n        try {\n            $filtered = $this-&gt;inputValidationService-&gt;validate(\n                $validators,\n                $request-&gt;getParams()\n            );\n\n            // Use validated data\n            $email = $filtered['email'];\n            $password = $filtered['password'];\n\n            // Perform action logic...\n\n            return $response;\n        } catch (ValidationException $e) {\n            // Handle validation errors\n            return $response-&gt;withStatus(400);\n        }\n    }\n}\n</code></pre>"},{"location":"input-validation/#default-validators","title":"Default Validators","text":"<p>The WebFramework provides several default validators to handle common validation scenarios. Here's a list of the available validators:</p>"},{"location":"input-validation/#emailvalidator","title":"EmailValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\EmailValidator</code></li> <li>Purpose: Validates email addresses.</li> <li>Usage: Ensures the input is a valid email format and optionally checks for a maximum length.</li> </ul>"},{"location":"input-validation/#example_1","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['email' =&gt; (new EmailValidator())-&gt;required()];\n</code></pre>"},{"location":"input-validation/#passwordvalidator","title":"PasswordValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\PasswordValidator</code></li> <li>Purpose: Validates passwords.</li> <li>Usage: Ensures the input meets password requirements, such as being non-empty.</li> </ul>"},{"location":"input-validation/#example_2","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['password' =&gt; new PasswordValidator()];\n</code></pre>"},{"location":"input-validation/#usernamevalidator","title":"UsernameValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\UsernameValidator</code></li> <li>Purpose: Validates usernames.</li> <li>Usage: Ensures the input is a valid username format and optionally checks for a maximum length.</li> </ul>"},{"location":"input-validation/#example_3","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['username' =&gt; (new UsernameValidator())-&gt;required()];\n</code></pre>"},{"location":"input-validation/#customboolvalidator","title":"CustomBoolValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\CustomBoolValidator</code></li> <li>Purpose: Validates boolean values.</li> <li>Usage: Ensures the input is either '0', '1', 'true', or 'false'.</li> </ul>"},{"location":"input-validation/#example_4","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['accept_terms' =&gt; (new CustomBoolValidator('accept_terms'))-&gt;required()];\n</code></pre>"},{"location":"input-validation/#customnumbervalidator","title":"CustomNumberValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\CustomNumberValidator</code></li> <li>Purpose: Validates numeric values.</li> <li>Usage: Ensures the input is a number and optionally checks for minimum and maximum values.</li> </ul>"},{"location":"input-validation/#example_5","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['age' =&gt; (new CustomNumberValidator('age'))-&gt;minValue(18)-&gt;maxValue(99)];\n</code></pre>"},{"location":"input-validation/#idvalidator","title":"IdValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\IdValidator</code></li> <li>Purpose: Validates ID fields.</li> <li>Usage: Ensures the input is a valid ID format and can be converted to an integer.</li> </ul>"},{"location":"input-validation/#example_6","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['user_id' =&gt; (new IdValidator('user_id'))-&gt;required()];\n</code></pre>"},{"location":"input-validation/#urlvalidator","title":"UrlValidator","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Validator\\UrlValidator</code></li> <li>Purpose: Validates Url fields.</li> <li>Usage: Ensures the input is a valid Url format.</li> </ul>"},{"location":"input-validation/#example_7","title":"Example","text":"<pre><code>&lt;?php\n\n$validators = ['url' =&gt; (new UrlValidator('url'))-&gt;required()];\n</code></pre>"},{"location":"input-validation/#using-customvalidator","title":"Using CustomValidator","text":"<p>The <code>WebFramework\\Validation\\Validator\\CustomValidator</code> class is a flexible validator that can be extended to create custom validation logic. It provides basic validation functionality and can be configured with various rules.</p>"},{"location":"input-validation/#key-features","title":"Key Features","text":"<ul> <li>Filter: Apply a regex filter to the input.</li> <li>Required: Mark the field as required.</li> <li>Min/Max Length: Set minimum and maximum length constraints.</li> <li>Default Value: Specify a default value if the input is empty.</li> </ul>"},{"location":"input-validation/#example-usage","title":"Example Usage","text":"<p>To create a custom validator, extend the <code>CustomValidator</code> class and define your validation logic:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Validation\\CustomValidator;\n\nclass MyCustomValidator extends CustomValidator\n{\n    public function __construct(string $name)\n    {\n        parent::__construct($name);\n        $this-&gt;filter('my_custom_regex')-&gt;required()-&gt;maxLength(100);\n    }\n\n    public function getTyped(string $value): mixed\n    {\n        // Custom conversion logic\n        return strtoupper($value);\n    }\n}\n</code></pre>"},{"location":"input-validation/#validation-rules","title":"Validation Rules","text":"<p>The WebFramework includes several implementations of the <code>ValidationRule</code> interface, which are used to define specific validation criteria for input data. Here are the available rules:</p>"},{"location":"input-validation/#filterrule","title":"FilterRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\FilterRule</code></li> <li>Purpose: Provides regex-based filtering.</li> <li>Usage: Ensures the input matches a specified regular expression.</li> </ul>"},{"location":"input-validation/#maxlengthrule","title":"MaxLengthRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\MaxLengthRule</code></li> <li>Purpose: Validates maximum length.</li> <li>Usage: Ensures the input does not exceed a specified length.</li> </ul>"},{"location":"input-validation/#minlengthrule","title":"MinLengthRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\MinLengthRule</code></li> <li>Purpose: Validates minimum length.</li> <li>Usage: Ensures the input meets a specified minimum length.</li> </ul>"},{"location":"input-validation/#maxvaluerule","title":"MaxValueRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\MaxValueRule</code></li> <li>Purpose: Validates maximum value.</li> <li>Usage: Ensures the input does not exceed a specified value.</li> </ul>"},{"location":"input-validation/#minvaluerule","title":"MinValueRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\MinValueRule</code></li> <li>Purpose: Validates minimum value.</li> <li>Usage: Ensures the input meets a specified minimum value.</li> </ul>"},{"location":"input-validation/#urlrule","title":"UrlRule","text":"<ul> <li>Class: <code>WebFramework\\Validation\\Rule\\UrlRule</code></li> <li>Purpose: Validates an url structure.</li> <li>Usage: Ensures the input is an url.</li> </ul> <p>These rules can be used in conjunction with validators to enforce specific constraints on input data, ensuring that it meets the required criteria before being processed.</p>"},{"location":"instrumentation/","title":"Instrumentation","text":"<p>This document provides a guide for developers on the instrumentation system in WebFramework. Instrumentation is used to monitor and measure the performance of your application, allowing you to identify bottlenecks and optimize performance.</p>"},{"location":"instrumentation/#overview","title":"Overview","text":"<p>Instrumentation in WebFramework is designed to track the execution time of various parts of your application. It is implemented using the <code>Instrumentation</code> interface, which provides methods for starting and finishing spans and transactions.</p>"},{"location":"instrumentation/#when-to-use-instrumentation","title":"When to Use Instrumentation","text":"<p>Instrumentation is useful in scenarios where you need to monitor the performance of your application, such as:</p> <ul> <li>Identifying slow database queries or external API calls.</li> <li>Measuring the execution time of specific actions or middleware.</li> <li>Tracking the overall performance of your application in production.</li> </ul>"},{"location":"instrumentation/#adding-instrumentation-to-your-classes","title":"Adding Instrumentation to Your Classes","text":"<p>To add instrumentation to your own classes, you need to inject the <code>Instrumentation</code> service and use its methods to start and finish spans.</p>"},{"location":"instrumentation/#example-usage","title":"Example Usage","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Diagnostics\\Instrumentation;\n\nclass ExampleService\n{\n    public function __construct(\n        private Instrumentation $instrumentation,\n    ) {}\n\n    public function performTask(): void\n    {\n        $span = $this-&gt;instrumentation-&gt;startSpan('example.perform_task');\n\n        // Perform the task...\n\n        $this-&gt;instrumentation-&gt;finishSpan($span);\n    }\n}\n</code></pre> <p>In this example, the <code>ExampleService</code> uses the <code>Instrumentation</code> service to measure the execution time of the <code>performTask</code> method.</p>"},{"location":"instrumentation/#existing-instrumentation-locations","title":"Existing Instrumentation Locations","text":"<p>Instrumentation is already used in various parts of the WebFramework to measure the speed of actions and middleware. Here are some key locations:</p> <ul> <li>SlimAppTask: Measures the time taken to handle a request in the Slim application.</li> <li>InstrumentationMiddleware: Measures the time taken to process each request.</li> <li>SanityCheckRunner: Measures the time taken to execute sanity checks.</li> <li>CaptchaService: Measures the time taken to validate captchas.</li> <li>LatteRenderService: Measures the time taken to render templates using Latte.</li> <li>PostmarkMailService: Measures the time taken to send emails using Postmark.</li> <li>RedisCache: Measures the time taken for cache operations using Redis.</li> <li>MysqliDatabase: Measures the time taken for database queries using MySQLi.</li> </ul>"},{"location":"instrumentation/#writing-a-custom-instrumentation-handler","title":"Writing a Custom Instrumentation Handler","text":"<p>To write a custom instrumentation handler, you need to implement the <code>Instrumentation</code> interface. This interface defines the methods required for starting and finishing spans and transactions.</p>"},{"location":"instrumentation/#example-custom-instrumentation-handler","title":"Example Custom Instrumentation Handler","text":"<pre><code>&lt;?php\n\nnamespace App\\Instrumentation;\n\nuse WebFramework\\Diagnostics\\Instrumentation;\n\nclass CustomInstrumentation implements Instrumentation\n{\n    public function startTransaction(string $name, string $operation): mixed\n    {\n        // Start a new transaction with the given name and operation\n        // Return a transaction object or identifier\n    }\n\n    public function finishTransaction(mixed $transaction): void\n    {\n        // Finish the given transaction\n    }\n\n    public function startSpan(string $name): mixed\n    {\n        // Start a new span with the given name\n        // Return a span object or identifier\n    }\n\n    public function finishSpan(mixed $span): void\n    {\n        // Finish the given span\n    }\n\n    public function getCurrentTransaction(): mixed\n    {\n        // Return the current transaction object or identifier\n    }\n\n    public function setTransactionName(mixed $transaction, string $name): void\n    {\n        // Set the name of the given transaction\n    }\n}\n</code></pre>"},{"location":"instrumentation/#integrating-the-custom-handler","title":"Integrating the Custom Handler","text":"<p>Once you have implemented your custom instrumentation handler, you need to register it in your dependency injection container. </p>"},{"location":"logging/","title":"Logging","text":"<p>WebFramework offers a flexible logging system that revolves around PSR-3 loggers, channels, and the <code>ChannelManager</code>. This document explains how to work with loggers, how default channels are wired, and how you can override or introduce additional channels.</p> <p>Monolog is used as the underlying logging library and included by default.</p>"},{"location":"logging/#channelmanager-and-logservice","title":"ChannelManager and LogService","text":"<p>The <code>WebFramework\\\\Logging\\\\ChannelManager</code> resolves loggers by channel name. It uses the dependency injection container to look up services and caches resolved loggers for reuse. When no matching logger can be found the manager falls back to a <code>NullLogger</code>, so logging calls never break your application.</p> <p><code>WebFramework\\\\Logging\\\\LogService</code> is a convenience wrapper that mirrors the PSR-3 logging methods. You pass the channel name as the first argument and the message/level follows the usual PSR-3 signature:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Logging\\LogService;\n\nclass InvoiceService\n{\n    public function __construct(private LogService $logService) {}\n\n    public function createInvoice(): void\n    {\n        $this-&gt;logService-&gt;info('billing', 'Invoice created', ['customer' =&gt; 123]);\n    }\n}\n</code></pre> <p>It provides all the usual PSR-3 logging methods in this way with the channel name as the first argument: <code>log</code>, <code>emergency</code>, <code>alert</code>, <code>critical</code>, <code>error</code>, <code>warning</code>, <code>notice</code>, <code>info</code>, and <code>debug</code>.</p>"},{"location":"logging/#example-usage","title":"Example Usage","text":"<p>To use the default channel in your class, you can just inject <code>LoggerInterface</code> and use its methods, as LoggerInterface is mapped to retrieve the default channel in the container:</p> <pre><code>&lt;?php\n\nuse Psr\\Log\\LoggerInterface;\n\nclass ExampleService\n{\n    public function __construct(private LoggerInterface $logger) {}\n\n    public function logInfo(): void\n    {\n        $this-&gt;logger-&gt;info('Invoice created', ['customer' =&gt; 123]);\n    }\n}\n</code></pre> <p>To be able to send messages to other channels, you can inject <code>LogService</code> and use its methods:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Logging\\LogService;\n\nclass ExampleService\n{\n    public function __construct(private LogService $logService) {}\n\n    public function logInfo(): void\n    {\n        $this-&gt;logService-&gt;info('billing', 'Invoice created', ['customer' =&gt; 123]);\n    }\n}\n</code></pre>"},{"location":"logging/#default-channels","title":"Default Channels","text":"<p>Out of the box, WebFramework provides two channels, for which it provides default definition placeholders in <code>definitions/definitions.php</code>:</p> <ul> <li><code>channels.default</code></li> <li><code>channels.exception</code></li> </ul> <p>Both are bound to the <code>NullLogger</code>.</p> <p>To define the Logger for these (and other) channels, you can override the definition in your definitions file (e.g. <code>definitions/app_definitions.php</code>).</p>"},{"location":"logging/#adding-or-replacing-channel-definitions","title":"Adding or Replacing Channel Definitions","text":"<p>Channel definitions live in the dependency injection container. By convention they use the <code>channels.*</code> naming scheme. Each definition must return a <code>Psr\\Log\\LoggerInterface</code>. For example:</p> <pre><code>&lt;?php\n\nuse Monolog\\Handler\\StreamHandler;\nuse Monolog\\Level;\nuse Monolog\\Logger;\n\nreturn [\n    'channels.default' =&gt; function (): Logger {\n        $logger = new Logger('default');\n        $logger-&gt;pushHandler(new StreamHandler('/var/log/app.log', Level::Info));\n\n        return $logger;\n    },\n    'channels.billing' =&gt; function (): Logger {\n        $logger = new Logger('billing');\n        $logger-&gt;pushHandler(new StreamHandler('/var/log/billing.log', Level::Debug));\n\n        return $logger;\n    },\n];\n</code></pre> <p>Once such definitions exist, the <code>ChannelManager</code> can resolve the channel by asking the container for the corresponding service.</p>"},{"location":"logging/#overriding-channels-via-configuration","title":"Overriding Channels Via Configuration","text":"<p>The effective channels are determined by the <code>logging.channels</code> section in your configuration (see <code>config/base_config.php</code>). Each entry maps a channel name to a container id or to an inline configuration array:</p> <pre><code>&lt;?php\n\nreturn [\n    'logging' =&gt; [\n        'channels' =&gt; [\n            'default' =&gt; 'channels.default',\n            'exception' =&gt; [\n                'type' =&gt; 'file',\n                'path' =&gt; '/tmp/app-exceptions.log',\n                'level' =&gt; \\Monolog\\Level::Error,\n            ],\n        ],\n    ],\n];\n</code></pre> <ul> <li>If the value is a string, the manager asks the container for that service id.</li> <li>If the value is an array with <code>type =&gt; 'file'</code>, the manager creates a <code>Monolog\\Logger</code> on the fly that writes to <code>path</code> with an optional <code>level</code> (defaults to <code>Level::Debug</code>).</li> </ul> <p>This mechanism lets you temporarily override a definition\u2014handy for local debugging or when you want a different logger in production\u2014without touching the DI definitions themselves. Changing the mapping to reference another definition immediately redirects the channel to that logger.</p>"},{"location":"logging/#fallback-behaviour","title":"Fallback Behaviour","text":"<p>When neither the configuration nor the container can supply a logger for a channel, the manager returns a <code>NullLogger</code>. This guarantees that logging is safe even while you are still wiring channels.</p> <p>With these tools you can keep the framework supplied <code>LoggerInterface</code> for generic logging, add specialised channels for specific domains, and override them per environment whenever needed.</p>"},{"location":"mailing/","title":"Mailing System","text":"<p>The WebFramework provides a flexible mailing system that supports both synchronous and asynchronous email sending. The system is designed to separate the queuing mechanism from the actual email backend, allowing you to easily switch between different email providers without changing your application code.</p>"},{"location":"mailing/#core-components","title":"Core Components","text":""},{"location":"mailing/#mailservice-interface","title":"MailService Interface","text":"<p>The <code>MailService</code> interface defines the contract for mail service implementations. It provides two methods for sending emails:</p> <pre><code>&lt;?php\n\ninterface MailService\n{\n    public function sendRawMail(?string $from, string $recipient, string $title, string $message): bool|string;\n    public function sendTemplateMail(string $templateId, ?string $from, string $recipient, array $templateVariables): bool|string;\n}\n</code></pre>"},{"location":"mailing/#mailbackend-interface","title":"MailBackend Interface","text":"<p>The <code>MailBackend</code> interface has the same contract as <code>MailService</code> but represents the actual email sending backend (e.g., Postmark, SMTP). This interface is used by queue handlers to send emails after they've been queued.</p> <pre><code>&lt;?php\n\ninterface MailBackend\n{\n    public function sendRawMail(?string $from, string $recipient, string $title, string $message): bool|string;\n    public function sendTemplateMail(string $templateId, ?string $from, string $recipient, array $templateVariables): bool|string;\n}\n</code></pre>"},{"location":"mailing/#built-in-implementations","title":"Built-in Implementations","text":""},{"location":"mailing/#nullmailservice","title":"NullMailService","text":"<p>The <code>NullMailService</code> is a no-op implementation that implements both <code>MailService</code> and <code>MailBackend</code>. It's useful for testing or when email functionality is not required. All methods return <code>true</code> without actually sending any emails.</p>"},{"location":"mailing/#queuedmailservice","title":"QueuedMailService","text":"<p>The <code>QueuedMailService</code> implements <code>MailService</code> and queues email jobs instead of sending them immediately. This allows you to send emails asynchronously, reducing latency in your main application thread.</p> <p>When using <code>QueuedMailService</code>, emails are dispatched to the queue system and processed by job handlers that use <code>MailBackend</code> to actually send the emails.</p>"},{"location":"mailing/#configuration","title":"Configuration","text":""},{"location":"mailing/#synchronous-email-sending","title":"Synchronous Email Sending","text":"<p>To send emails synchronously (immediately), bind <code>MailService</code> to your backend implementation:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Mail\\MailService;\nuse YourModule\\PostmarkMailService;\n\nreturn [\n    MailService::class =&gt; DI\\autowire(PostmarkMailService::class),\n];\n</code></pre>"},{"location":"mailing/#asynchronous-email-sending","title":"Asynchronous Email Sending","text":"<p>To send emails asynchronously (queued), configure both <code>MailService</code> and <code>MailBackend</code>:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Mail\\MailService;\nuse WebFramework\\Mail\\MailBackend;\nuse WebFramework\\Mail\\QueuedMailService;\nuse YourModule\\PostmarkMailService;\n\nreturn [\n    // Queue emails instead of sending immediately\n    MailService::class =&gt; DI\\autowire(QueuedMailService::class),\n\n    // Backend used by queue handlers to actually send emails\n    MailBackend::class =&gt; DI\\autowire(PostmarkMailService::class),\n];\n</code></pre> <p>Important: When using <code>QueuedMailService</code>, you must also bind <code>MailBackend</code> to your actual email backend implementation. The queue handlers will use <code>MailBackend</code> to send emails, preventing an infinite queuing loop.</p>"},{"location":"mailing/#queue-worker-setup","title":"Queue Worker Setup","text":"<p>For asynchronous email sending to work, you need to run a queue worker:</p> <pre><code>php scripts/framework.php queue:worker default\n</code></pre> <p>By default, the mail job handlers (<code>RawMailJobHandler</code> and <code>TemplateMailJobHandler</code>) are automatically registered when the <code>QueueService</code> is instantiated in the <code>definitions.php</code> file. If you want to register your own job handlers, you can do so by registering them with the <code>QueueService</code> in your application definitions. Use DI\\decorate to register your own job handlers in addition to the default ones, use DI\\autowire to register your own job handlers and override the default ones.</p> <pre><code>&lt;?php\n\nuse WebFramework\\Queue\\QueueService;\n\nreturn [\n    QueueService::class =&gt; DI\\decorate(function (QueueService $queueService) {\n        $queueService-&gt;registerJobHandler(MyCustomJob::class, MyCustomJobHandler::class);\n\n        return $queueService;\n    }),\n]\n</code></pre>"},{"location":"mailing/#usage","title":"Usage","text":""},{"location":"mailing/#injecting-mailservice","title":"Injecting MailService","text":"<p>Inject <code>MailService</code> into your classes via constructor injection:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Mail\\MailService;\n\nclass MyService\n{\n    public function __construct(\n        private MailService $mailService,\n    ) {}\n\n    public function sendWelcomeEmail(string $email): void\n    {\n        $this-&gt;mailService-&gt;sendRawMail(\n            null, // Use default sender\n            $email,\n            'Welcome!',\n            'Thank you for joining us.'\n        );\n    }\n}\n</code></pre>"},{"location":"mailing/#sending-raw-emails","title":"Sending Raw Emails","text":"<p>Use <code>sendRawMail()</code> to send emails with plain text or HTML content:</p> <pre><code>&lt;?php\n\n$result = $this-&gt;mailService-&gt;sendRawMail(\n    'sender@example.com',  // From address (null to use default)\n    'recipient@example.com', // Recipient\n    'Email Subject',         // Subject\n    '&lt;h1&gt;Hello&lt;/h1&gt;&lt;p&gt;This is the email body.&lt;/p&gt;' // Message body\n);\n\nif ($result !== true) {\n    // Handle error - $result contains error message\n    error_log('Failed to send email: ' . $result);\n}\n</code></pre>"},{"location":"mailing/#sending-template-emails","title":"Sending Template Emails","text":"<p>Use <code>sendTemplateMail()</code> to send emails using templates configured in your email provider:</p> <pre><code>&lt;?php\n\n$result = $this-&gt;mailService-&gt;sendTemplateMail(\n    'welcome-email',              // Template ID\n    'sender@example.com',         // From address (null to use default)\n    'recipient@example.com',     // Recipient\n    [                             // Template variables\n        'username' =&gt; 'John Doe',\n        'action_url' =&gt; 'https://example.com/verify',\n    ]\n);\n\nif ($result !== true) {\n    // Handle error\n    error_log('Failed to send template email: ' . $result);\n}\n</code></pre>"},{"location":"mailing/#usermailer-helper","title":"UserMailer Helper","text":"<p>The framework provides a <code>UserMailer</code> helper class for common user-related emails:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Mail\\UserMailer;\n\nclass MyService\n{\n    public function __construct(\n        private UserMailer $userMailer,\n    ) {}\n\n    public function sendVerificationEmail(User $user, string $verifyUrl): void\n    {\n        $this-&gt;userMailer-&gt;emailVerificationLink($user-&gt;getEmail(), [\n            'verify_url' =&gt; $verifyUrl,\n            'user' =&gt; [\n                'username' =&gt; $user-&gt;getUsername(),\n            ],\n        ]);\n    }\n}\n</code></pre> <p>Available <code>UserMailer</code> methods: - <code>emailVerificationLink()</code> - Send email verification link - <code>changeEmailVerificationLink()</code> - Send change email verification link - <code>passwordReset()</code> - Send password reset email - <code>newPassword()</code> - Send new password email</p>"},{"location":"mailing/#template-configuration","title":"Template Configuration","text":"<p>You can override default template IDs used by <code>UserMailer</code> in your configuration:</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p> <pre><code>&lt;?php\n\nreturn [\n    'user_mailer' =&gt; [\n        'template_overrides' =&gt; [\n            'email-verification-code' =&gt; 'my-custom-verification-template',\n            'change-email-verification-code' =&gt; 'my-custom-change-email-template',\n            'password-reset' =&gt; 'my-custom-password-reset-template',\n            'new-password' =&gt; 'my-custom-new-password-template',\n        ],\n    ],\n];\n</code></pre>"},{"location":"mailing/#default-sender-configuration","title":"Default Sender Configuration","text":"<p>Configure the default sender email address:</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p> <pre><code>&lt;?php\n\nreturn [\n    'sender_core' =&gt; [\n        'default_sender' =&gt; 'noreply@example.com',\n    ],\n];\n</code></pre>"},{"location":"mailing/#error-handling","title":"Error Handling","text":"<p>Both <code>sendRawMail()</code> and <code>sendTemplateMail()</code> return: - <code>true</code> if the email was sent successfully (or queued successfully when using <code>QueuedMailService</code>) - A string containing an error message if sending failed</p> <p>Always check the return value:</p> <pre><code>&lt;?php\n\n$result = $this-&gt;mailService-&gt;sendRawMail(null, $email, $subject, $body);\n\nif ($result !== true) {\n    // Log error or handle failure\n    $this-&gt;logger-&gt;error('Email send failed', ['error' =&gt; $result]);\n    return false;\n}\n</code></pre>"},{"location":"mailing/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Use QueuedMailService for Production: Asynchronous email sending reduces latency and improves user experience. Always use <code>QueuedMailService</code> in production environments.</p> </li> <li> <p>Separate MailService and MailBackend: When using async sending, keep <code>MailService</code> bound to <code>QueuedMailService</code> and <code>MailBackend</code> bound to your actual email provider. This prevents infinite queuing loops.</p> </li> <li> <p>Handle Errors Gracefully: Always check return values and handle errors appropriately. Failed emails should be logged for debugging.</p> </li> <li> <p>Use Templates When Possible: Template emails are easier to manage and update than raw HTML emails. They also support better personalization.</p> </li> <li> <p>Monitor Queue Workers: Ensure queue workers are running when using <code>QueuedMailService</code>. Emails won't be sent until workers process the queue.</p> </li> <li> <p>Test with NullMailService: Use <code>NullMailService</code> in test environments to avoid sending actual emails during testing.</p> </li> </ol>"},{"location":"mailing/#integration-with-queue-system","title":"Integration with Queue System","text":"<p>The mailing system integrates seamlessly with the queue system. When using <code>QueuedMailService</code>:</p> <ol> <li>Emails are dispatched as <code>RawMailJob</code> or <code>TemplateMailJob</code> to the queue</li> <li>Queue workers process these jobs using registered handlers</li> <li>Handlers use <code>MailBackend</code> to actually send emails</li> <li>Failed jobs are retried according to queue configuration</li> </ol> <p>For more information on the queue system, see the Queueing documentation.</p>"},{"location":"middlewares/","title":"Middleware Management","text":"<p>This document provides a guide for developers on how to define and use middleware in the WebFramework. Middleware is used to process requests and responses in a Slim application, allowing you to add functionality such as authentication, logging, and error handling.</p>"},{"location":"middlewares/#defining-middleware-in-configuration","title":"Defining Middleware in Configuration","text":"<p>Middleware is defined in the configuration file under the <code>middlewares</code> key. The configuration is divided into two sections: <code>pre_routing</code> and <code>post_routing</code>.</p> <ul> <li> <p><code>pre_routing</code>: Middleware in this section is executed before the routing process receives the request and after the routing process has handled the request. It is therefore mainly used to catch errors that occur during routing or in the middlewares after routing.</p> </li> <li> <p><code>post_routing</code>: Middleware in this section is executed after the routing process. It is used for tasks that need to be completed after determining which action to route to, such as starting a session or handling security.</p> </li> </ul>"},{"location":"middlewares/#middleware-order","title":"Middleware Order","text":"<p>Middleware is executed in the order it is defined in the configuration file. The first middleware in the list is the last to be executed (end of the stack), and the last middleware in the list is the first to be executed (start of the stack). This means that middleware is entered and exited in a Last-In-First-Out (LIFO) order.</p> <p>During routing route-specific middleware, such as LoggedInMiddleware or AdminUserMiddleware can be added on top of the post_routing list.</p>"},{"location":"middlewares/#example-configuration","title":"Example Configuration","text":"<p>Most applications will use the following configuration:</p> <pre><code>&lt;?php\n\nreturn\n    'pre_routing' =&gt; [\n        // End of stack\n        ErrorRedirectMiddleware::class,\n        // Start of stack\n    ],\n    'post_routing' =&gt; [\n        // End of stack\n        RequestServiceMiddleware::class,\n        SecurityHeadersMiddleware::class,\n        MessageMiddleware::class,\n        JsonParserMiddleware::class,\n        BlacklistMiddleware::class,\n        CsrfValidationMiddleware::class,\n        AuthenticationMiddleware::class,\n        IpMiddleware::class,\n        SessionStartMiddleware::class,\n        // Start of stack\n    ],\n];\n</code></pre> <p>In this configuration, <code>ErrorRedirectMiddleware</code> is executed first in the <code>pre_routing</code> stack, and <code>SessionStartMiddleware</code> is executed first in the <code>post_routing</code> stack.</p>"},{"location":"middlewares/#routing-and-middleware","title":"Routing and Middleware","text":"<p>Routing is done between the <code>pre_routing</code> and <code>post_routing</code> middleware stacks by the <code>RoutingMiddleware</code> of the Slim framework. The first entry of <code>post_routing</code> will call the actual action routed to.</p>"},{"location":"middlewares/#purpose-of-standard-middleware-implementations","title":"Purpose of Standard Middleware Implementations","text":"<p>Here is a description of the purpose of each standard middleware implementation:</p>"},{"location":"middlewares/#errorredirectmiddleware","title":"ErrorRedirectMiddleware","text":"<ul> <li>Purpose: Handles errors and exceptions by redirecting to appropriate error pages or handling exceptions gracefully.</li> </ul>"},{"location":"middlewares/#authenticationmiddleware","title":"AuthenticationMiddleware","text":"<ul> <li>Purpose: Determines if there is an authenticated user and adds the info the the request attributes.</li> </ul>"},{"location":"middlewares/#transactionmiddleware","title":"TransactionMiddleware","text":"<ul> <li>Purpose: Ensures that the request is wrapped in a database transaction, committing the transaction if the request is successful or rolling it back if an error occurs.</li> </ul>"},{"location":"middlewares/#securityheadersmiddleware","title":"SecurityHeadersMiddleware","text":"<ul> <li>Purpose: Adds security headers to the response, such as <code>X-Frame-Options</code> to prevent clickjacking and a random header to mitigate BREACH attacks.</li> </ul>"},{"location":"middlewares/#messagemiddleware","title":"MessageMiddleware","text":"<ul> <li>Purpose: Handles messages passed via URL parameters, adding them to the message service for display to the user.</li> </ul>"},{"location":"middlewares/#jsonparsermiddleware","title":"JsonParserMiddleware","text":"<ul> <li>Purpose: Parses JSON request bodies and adds the parsed data to the request attributes for easy access.</li> </ul>"},{"location":"middlewares/#blacklistmiddleware","title":"BlacklistMiddleware","text":"<ul> <li>Purpose: Checks if a request is blacklisted based on IP address or user ID, throwing a <code>BlacklistException</code> if the request is blacklisted.</li> </ul>"},{"location":"middlewares/#csrfvalidationmiddleware","title":"CsrfValidationMiddleware","text":"<ul> <li>Purpose: Validates CSRF tokens to protect against cross-site request forgery attacks, adding an error message if validation fails.</li> </ul>"},{"location":"middlewares/#ipmiddleware","title":"IpMiddleware","text":"<ul> <li>Purpose: Adds the client IP address to the request attributes for use in other middleware or actions.</li> </ul>"},{"location":"middlewares/#sessionstartmiddleware","title":"SessionStartMiddleware","text":"<ul> <li>Purpose: Starts a session for the request, allowing session data to be accessed and modified during the request lifecycle.</li> </ul>"},{"location":"middlewares/#loggedinmiddleware","title":"LoggedInMiddleware","text":"<ul> <li>Purpose: Checks if there is an authenticated user or throw an exception if not.</li> </ul>"},{"location":"middlewares/#adminusermiddleware","title":"AdminUserMiddleware","text":"<ul> <li>Purpose: Checks is there is an authenticated admin user or throw an exception if not.</li> </ul>"},{"location":"middlewares/#requestservicemiddleware","title":"RequestServiceMiddleware","text":"<ul> <li>Purpose: Store the current request in the RequestService for use in the application.</li> </ul>"},{"location":"modules/","title":"WebFramework Modules","text":"<p>WebFramework provides a modular architecture that allows you to extend its functionality through installable modules. These modules integrate seamlessly with the core framework and provide additional features for specific use cases.</p>"},{"location":"modules/#available-modules","title":"Available Modules","text":"<p>The following modules are available for WebFramework:</p>"},{"location":"modules/#webframework-mysql","title":"WebFramework MySQL","text":"<p>Package: <code>avoutic/web-framework-mysql</code></p> <p>Provides MySQL database integration for WebFramework.</p> <p>Features: - MySQL database connectivity - Integration with WebFramework's database layer</p> <p>Installation: <pre><code>composer require avoutic/web-framework-mysql\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-mysql/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Add the following <code>db_config.main.php</code> to your auth config directory (<code>config/auth</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'database_host' =&gt; env('DATABASE_HOST', 'localhost'),\n    'database_user' =&gt; env('DATABASE_USER', 'your_user'),\n    'database_password' =&gt; env('DATABASE_PASSWORD', 'your_password'),\n    'database_database' =&gt; env('DATABASE_DATABASE', 'your_database')\n];\n</code></pre> <p>Repository: github.com/avoutic/web-framework-mysql</p>"},{"location":"modules/#webframework-redis","title":"WebFramework Redis","text":"<p>Package: <code>avoutic/web-framework-redis</code></p> <p>Provides Redis caching integration for WebFramework.</p> <p>Features: - Redis-based caching implementation - Support for cache tags - Automatic instrumentation for performance tracking - PSR-16 compliant cache interface</p> <p>Installation: <pre><code>composer require avoutic/web-framework-redis\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-redis/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Override the <code>Cache</code> interface in your application definition file (<code>definitions/app_definitions.php</code>):</li> </ol> <pre><code>&lt;?php\n\nuse DI;\nuse WebFramework\\Cache\\Cache;\n\nreturn [\n    Cache::class =&gt; DI\\autowire(\\WebFramework\\Redis\\RedisCache::class),\n];\n</code></pre> <ol> <li>Add the following <code>redis.php</code> to your auth config directory (<code>config/auth</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'hostname' =&gt; env('REDIS_HOST', 'localhost'),\n    'port' =&gt; env('REDIS_PORT', 6379),\n    'password' =&gt; env('REDIS_PASSWORD', 'your_password')\n];\n</code></pre> <p>Repository: github.com/avoutic/web-framework-redis</p>"},{"location":"modules/#webframework-postmark","title":"WebFramework Postmark","text":"<p>Package: <code>avoutic/web-framework-postmark</code></p> <p>Provides Postmark email service integration for WebFramework.</p> <p>Features: - Send raw emails via Postmark - Send template-based emails via Postmark - Automatic instrumentation for email sending - Configurable default sender email - Error handling for common Postmark API issues</p> <p>Installation: <pre><code>composer require avoutic/web-framework-postmark\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-postmark/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Override the <code>MailService</code> interface (and optionally <code>MailBackend</code> for queued emails) in your application definition file (<code>definitions/app_definitions.php</code>):</li> </ol> <p>For synchronous email sending:</p> <pre><code>&lt;?php\n\nuse DI;\nuse WebFramework\\Mail\\MailService;\nuse WebFramework\\Postmark\\PostmarkMailService;\n\nreturn [\n    MailService::class =&gt; DI\\autowire(PostmarkMailService::class),\n];\n</code></pre> <p>For asynchronous (queued) email sending:</p> <pre><code>&lt;?php\n\nuse DI;\nuse WebFramework\\Mail\\MailService;\nuse WebFramework\\Mail\\MailBackend;\nuse WebFramework\\Mail\\QueuedMailService;\nuse WebFramework\\Postmark\\PostmarkMailService;\n\nreturn [\n    MailService::class =&gt; DI\\autowire(QueuedMailService::class),\n    MailBackend::class =&gt; DI\\autowire(PostmarkMailService::class),\n];\n</code></pre> <ol> <li>Add the following <code>postmark.php</code> to your auth config directory (<code>config/auth</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn 'your-api-key-here';\n</code></pre> <p>Repository: github.com/avoutic/web-framework-postmark</p>"},{"location":"modules/#webframework-browserless","title":"WebFramework Browserless","text":"<p>Package: <code>avoutic/web-framework-browserless</code></p> <p>Provides PDF generation capabilities using the Browserless service.</p> <p>Features: - Generate PDFs from web pages - Stream PDF output - Integration with WebFramework's response system</p> <p>Installation: <pre><code>composer require avoutic/web-framework-browserless\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-browserless/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Add the following <code>browserless.php</code> to your auth config directory (<code>config/auth</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'local_server' =&gt; 'http://your-local-server',\n    'pdf_endpoint' =&gt; 'https://your-browserless-instance/pdf',\n    'token' =&gt; 'your-browserless-token'\n];\n</code></pre> <p>Usage:</p> <p>The module provides methods to generate PDFs from web pages:</p> <pre><code>$browserless-&gt;outputPdf('/path/to/page', 'output.pdf');\n// or\n$stream = $browserless-&gt;outputStream('/path/to/page');\n</code></pre> <p>Repository: github.com/avoutic/web-framework-browserless</p>"},{"location":"modules/#webframework-sentry","title":"WebFramework Sentry","text":"<p>Package: <code>avoutic/web-framework-sentry</code></p> <p>Provides Sentry instrumentation for WebFramework, enabling performance monitoring and distributed tracing.</p> <p>Features: - Performance monitoring - Distributed tracing - Error tracking integration - Implements WebFramework Instrumentation interface</p> <p>Installation: <pre><code>composer require avoutic/web-framework-sentry\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-sentry/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Override the <code>Instrumentation</code> interface in your application definition file (<code>definitions/app_definitions.php</code>):</li> </ol> <pre><code>&lt;?php\n\nuse DI;\nuse WebFramework\\Diagnostics\\Instrumentation;\n\nreturn [\n    Instrumentation::class =&gt; DI\\autowire(\\WebFramework\\Sentry\\SentryInstrumentation::class),\n];\n</code></pre> <p>Repository: github.com/avoutic/web-framework-sentry</p>"},{"location":"modules/#webframework-stripe","title":"WebFramework Stripe","text":"<p>Package: <code>avoutic/web-framework-stripe</code></p> <p>Provides Stripe integration for WebFramework, offering a clean interface to interact with Stripe's API for handling payments, subscriptions, and webhooks.</p> <p>Features: - Stripe customer management - Product and price creation - Subscription handling - Webhook verification - Invoice retrieval - Production and development environment support</p> <p>Installation: <pre><code>composer require avoutic/web-framework-stripe\n</code></pre></p> <p>Configuration:</p> <ol> <li>Add the module's definition file to your <code>config.php</code>:</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'definition_files' =&gt; [\n        '../vendor/avoutic/web-framework/definitions/definitions.php',\n        '../vendor/avoutic/web-framework-stripe/definitions/definitions.php',\n        'app_definitions.php',\n    ],\n];\n</code></pre> <ol> <li>Add the following <code>stripe.php</code> to your auth config directory (<code>config/auth</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    'api_key' =&gt; 'your_stripe_secret_key',\n    'publishable_api_key' =&gt; 'your_publishable_api_key',\n    'endpoint_secret' =&gt; 'your_webhook_endpoint_secret'\n];\n</code></pre> <p>Repository: github.com/avoutic/web-framework-stripe</p>"},{"location":"modules/#installing-modules","title":"Installing Modules","text":"<p>All modules are installed via Composer. After installation, you typically need to:</p> <ol> <li>Install the package: Use <code>composer require</code> to add the module to your project</li> <li>Register definitions: Add the module's definition file to your <code>definition_files</code> array in your <code>config.php</code> file</li> <li>Override interfaces (if required): Some modules require you to override default interfaces in your application definition file (<code>definitions/app_definitions.php</code>). See each module's configuration section for details.</li> <li>Configure the module: Add the appropriate configuration file to your <code>config/auth</code> directory</li> </ol> <p>Note: Modules that override core interfaces (like <code>Cache</code>, <code>MailService</code>, or <code>Instrumentation</code>) require additional PHP-DI configuration in your application definition file. The Sentry module is an exception as it automatically overrides the <code>Instrumentation</code> interface in its own definition file.</p>"},{"location":"modules/#module-compatibility","title":"Module Compatibility","text":"<p>All modules listed above are compatible with WebFramework 8.x and require PHP 8.2 or higher. Always check the module's README file for the latest compatibility information and specific requirements.</p>"},{"location":"modules/#finding-more-modules","title":"Finding More Modules","text":"<p>For the latest list of available modules and their documentation, visit the avoutic GitHub page or search for <code>avoutic/web-framework-*</code> packages on Packagist.</p>"},{"location":"new-entity/","title":"Creating a new Entity","text":"<p>This document provides a guide for developers on how to create a new Entity class in the WebFramework. Entities are objects that represent data in the application and are persisted to the database. They should not contain any business logic, only data and methods for accessing and manipulating that data.</p>"},{"location":"new-entity/#steps-to-create-a-new-entity","title":"Steps to Create a New Entity","text":"<ol> <li> <p>Define the Entity Class: Create a new class that extends <code>EntityCore</code> and implements the necessary methods and properties.</p> </li> <li> <p>Define the Repository Class: Create a new class that extends <code>RepositoryCore</code> and provides methods for accessing and manipulating the entity data.</p> </li> <li> <p>Create the Database Table: Define a new database table that matches the structure of the entity.</p> </li> </ol>"},{"location":"new-entity/#example-creating-a-car-entity","title":"Example: Creating a <code>Car</code> Entity","text":""},{"location":"new-entity/#step-1-define-the-car-entity-class","title":"Step 1: Define the <code>Car</code> Entity Class","text":"<p>Create a new class <code>Car</code> that extends <code>EntityCore</code>. Define the properties and methods for accessing and manipulating the data.</p> <pre><code>&lt;?php\n\nnamespace WebFramework\\Entity;\n\nuse WebFramework\\Entity\\EntityCore;\n\n/**\n * Represents a car in the system.\n */\nclass Car extends EntityCore\n{\n    protected static string $tableName = 'cars';\n    protected static array $baseFields = ['make', 'model', 'year', 'color'];\n    protected static array $privateFields = [];\n\n    protected int $id;\n    protected string $make = '';\n    protected string $model = '';\n    protected int $year = 0;\n    protected string $color = '';\n\n    public function getId(): int\n    {\n        return $this-&gt;id;\n    }\n\n    public function getMake(): string\n    {\n        return $this-&gt;make;\n    }\n\n    public function setMake(string $make): void\n    {\n        $this-&gt;make = $make;\n    }\n\n    public function getModel(): string\n    {\n        return $this-&gt;model;\n    }\n\n    public function setModel(string $model): void\n    {\n        $this-&gt;model = $model;\n    }\n\n    public function getYear(): int\n    {\n        return $this-&gt;year;\n    }\n\n    public function setYear(int $year): void\n    {\n        $this-&gt;year = $year;\n    }\n\n    public function getColor(): string\n    {\n        return $this-&gt;color;\n    }\n\n    public function setColor(string $color): void\n    {\n        $this-&gt;color = $color;\n    }\n}\n</code></pre>"},{"location":"new-entity/#step-2-define-the-carrepository-class","title":"Step 2: Define the <code>CarRepository</code> Class","text":"<p>Create a new class <code>CarRepository</code> that extends <code>RepositoryCore</code>. Implement methods for accessing and manipulating <code>Car</code> entities.</p> <pre><code>&lt;?php\n\nnamespace WebFramework\\Repository;\n\nuse WebFramework\\Entity\\EntityCollection;\nuse WebFramework\\Repository\\RepositoryCore;\nuse WebFramework\\Entity\\Car;\n\n/**\n * Repository class for Car entities.\n *\n * @extends RepositoryCore&lt;Car&gt;\n */\nclass CarRepository extends RepositoryCore\n{\n    /** @var class-string&lt;Car&gt; The entity class associated with this repository */\n    protected static string $entityClass = Car::class;\n\n    /**\n     * Get a Car entity by make and model.\n     *\n     * @param string $make  The make of the car\n     * @param string $model The model of the car\n     *\n     * @return null|Car The Car entity if found, null otherwise\n     */\n    public function getCarByMakeAndModel(string $make, string $model): ?Car\n    {\n        return $this-&gt;getObject(['make' =&gt; $make, 'model' =&gt; $model]);\n    }\n\n    /**\n     * Search for cars based on a string.\n     *\n     * @param string $string The search string\n     *\n     * @return EntityCollection&lt;Car&gt; A collection of matching Car entities\n     */\n    public function searchCars(string $string): EntityCollection\n    {\n        $query = &lt;&lt;&lt;'SQL'\n        SELECT id\n        FROM cars\n        WHERE make LIKE ? OR\n              model LIKE ? OR\n              color LIKE ?\nSQL;\n\n        $result = $this-&gt;database-&gt;query($query, [\n            \"%{$string}%\",\n            \"%{$string}%\",\n            \"%{$string}%\",\n        ], 'Failed to search cars');\n\n        $data = [];\n        foreach ($result as $row)\n        {\n            $car = $this-&gt;getObjectById($row['id']);\n\n            if ($car === null)\n            {\n                throw new \\RuntimeException('Failed to retrieve car');\n            }\n\n            $data[] = $car;\n        }\n\n        return new EntityCollection($data);\n    }\n}\n</code></pre>"},{"location":"new-entity/#step-3-create-the-database-table","title":"Step 3: Create the Database Table","text":"<p>Define a new database table <code>cars</code> that matches the structure of the <code>Car</code> entity. This is typically done through a database migration. The <code>DatabaseManager</code> class is used to manage database schema changes.</p> <p>Check out the Database Migrations documentation for more information on how to create and apply database migrations.</p> <p>The migration file uses a timestamp-based system with <code>up</code> and <code>down</code> directions. The <code>up</code> actions contain the schema changes to apply the migration, while the <code>down</code> actions contain the changes to rollback the migration. The timestamp in the filename ensures migrations are applied in chronological order, and the migrations table automatically tracks which migrations have been executed.</p> <p>You don't need to include a field for the <code>id</code> column in the <code>actions</code> array, as it will be added automatically.</p> <p>To perform the migration you would typically run the new migration command by executing <code>php Framework db:migrate</code> in the console of your system.</p>"},{"location":"new-entity/#example-migration-file","title":"Example Migration File","text":"<pre><code>&lt;?php\n\nreturn [\n    'up' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'create_table',\n                'table_name' =&gt; 'cars',\n                'fields' =&gt; [\n                    [\n                        'name' =&gt; 'make',\n                        'type' =&gt; 'varchar',\n                        'size' =&gt; 255,\n                        'null' =&gt; false,\n                    ],\n                    [\n                        'name' =&gt; 'model',\n                        'type' =&gt; 'varchar',\n                        'size' =&gt; 255,\n                        'null' =&gt; false,\n                    ],\n                    [\n                        'name' =&gt; 'year',\n                        'type' =&gt; 'int',\n                        'null' =&gt; false,\n                    ],\n                    [\n                        'name' =&gt; 'color',\n                        'type' =&gt; 'varchar',\n                        'size' =&gt; 255,\n                        'null' =&gt; false,\n                    ],\n                ],\n                'constraints' =&gt; [],\n            ],\n        ],\n    ],\n    'down' =&gt; [\n        'actions' =&gt; [\n            [\n                'type' =&gt; 'raw_query',\n                'query' =&gt; 'DROP TABLE IF EXISTS `cars`',\n                'params' =&gt; [],\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"queueing/","title":"Queueing System","text":"<p>The WebFramework provides a flexible queueing system for handling background jobs. This system allows you to process tasks asynchronously, improving application responsiveness.</p>"},{"location":"queueing/#core-components","title":"Core Components","text":""},{"location":"queueing/#queueservice","title":"QueueService","text":"<p>The <code>QueueService</code> is the central manager for all queues in the application. It provides methods to:</p> <ul> <li>Register queues</li> <li>Dispatch jobs</li> <li>Get queue job counts</li> <li>Register job handlers</li> <li>Retrieve job handlers for processing</li> </ul>"},{"location":"queueing/#queue-interface","title":"Queue Interface","text":"<p>The <code>Queue</code> interface defines the contract that all queue implementations must follow:</p> <pre><code>&lt;?php\n\ninterface Queue\n{\n    public function dispatch(Job $job, int $delay = 0, int $maxAttempts = 3): void;\n    public function count(): int;\n    public function popJob(): ?Job;\n    public function getName(): string;\n    public function clear(): void;\n    public function markJobCompleted(Job $job): void;\n    public function markJobFailed(Job $job, ?\\Throwable $exception = null): void;\n}\n</code></pre>"},{"location":"queueing/#job-interface","title":"Job Interface","text":"<p>Jobs are simple data containers that implement the <code>Job</code> interface. They should contain only the data needed to perform the task, not the logic.</p> <p>All jobs must implement the following methods:</p> <pre><code>&lt;?php\n\ninterface Job\n{\n    public function getJobId(): string;\n    public function setJobId(string $jobId): void;\n    public function getJobName(): string;\n}\n</code></pre> <p>The <code>QueueService</code> automatically sets the job ID when dispatching. The job name should uniquely identify the type of job.</p>"},{"location":"queueing/#jobhandler-interface","title":"JobHandler Interface","text":"<p>Job handlers implement the <code>JobHandler</code> interface and contain the actual logic for processing jobs:</p> <pre><code>&lt;?php\n\ninterface JobHandler\n{\n    public function handle(Job $job): void;\n}\n</code></pre> <p>The <code>handle()</code> method should throw an exception if the job fails to execute. If no exception is thrown, the job is considered successfully processed and will be removed from the queue.</p> <p>Common exceptions to throw: - <code>InvalidJobException</code> - when the job type doesn't match the handler's expected type - <code>JobDataException</code> - when required job data is missing - <code>JobExecutionException</code> - when the job execution fails (e.g., mail delivery failure)</p>"},{"location":"queueing/#usage","title":"Usage","text":""},{"location":"queueing/#registering-a-queue","title":"Registering a Queue","text":"<pre><code>&lt;?php\n\n$queueService-&gt;register('email', $emailQueue, true); // true makes it the default queue\n</code></pre>"},{"location":"queueing/#creating-a-job","title":"Creating a Job","text":"<p>You can either use public readonly properties or private properties with public getters.</p> <pre><code>&lt;?php\n\nclass SendEmailJob implements Job\n{\n    private string $jobId = '';\n\n    public function __construct(\n        public readonly string $to,\n        public readonly string $subject,\n        public readonly string $body\n    ) {}\n\n    public function getJobId(): string\n    {\n        return $this-&gt;jobId;\n    }\n\n    public function setJobId(string $jobId): void\n    {\n        $this-&gt;jobId = $jobId;\n    }\n\n    public function getJobName(): string\n    {\n        return 'SendEmailJob';\n    }\n}\n</code></pre>"},{"location":"queueing/#creating-a-job-handler","title":"Creating a Job Handler","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Exception\\InvalidJobException;\nuse WebFramework\\Exception\\JobExecutionException;\n\n/**\n * @implements JobHandler&lt;Job&gt;\n */\nclass SendEmailJobHandler implements JobHandler\n{\n    public function handle(Job $job): void\n    {\n        if (!$job instanceof SendEmailJob) {\n            /** @var class-string $jobClass */\n            $jobClass = get_class($job);\n            throw new InvalidJobException(SendEmailJob::class, $jobClass);\n        }\n\n        // Send email logic here\n        // If sending fails, throw JobExecutionException\n        if (!$this-&gt;sendEmail($job)) {\n            throw new JobExecutionException($job-&gt;getJobName(), 'Failed to send email');\n        }\n    }\n}\n</code></pre>"},{"location":"queueing/#registering-a-job-handler","title":"Registering a Job Handler","text":"<pre><code>&lt;?php\n\n$queueService-&gt;registerJobHandler(SendEmailJob::class, SendEmailJobHandler::class);\n</code></pre>"},{"location":"queueing/#dispatching-a-job","title":"Dispatching a Job","text":"<pre><code>&lt;?php\n\n$job = new SendEmailJob('user@example.com', 'Hello', 'Welcome!');\n$queueService-&gt;dispatch($job); // Uses default queue\n$queueService-&gt;dispatch($job, 'email', 60); // Uses 'email' queue with 60 second delay\n$queueService-&gt;dispatch($job, 'email', 0, 5); // Uses 'email' queue with 5 max retry attempts\n</code></pre> <p>The <code>dispatch()</code> method signature is: - <code>dispatch(Job $job, string $queue = 'default', int $delay = 0, int $maxAttempts = 3)</code></p>"},{"location":"queueing/#running-a-queue-worker","title":"Running a Queue Worker","text":"<p>Queue workers can be started using the console command:</p> <pre><code>php framework queue:worker email --max-jobs=100 --max-runtime=3600\n</code></pre> <p>Options: - <code>--max-jobs</code>: Maximum number of jobs to process before stopping - <code>--max-runtime</code>: Maximum runtime in seconds before stopping</p> <p>The worker will: - Process jobs from the specified queue - Automatically handle job failures and retries - Sleep for 1 second when no jobs are available - Stop when max-jobs or max-runtime is reached</p>"},{"location":"queueing/#built-in-implementations","title":"Built-in Implementations","text":""},{"location":"queueing/#memoryqueue","title":"MemoryQueue","text":"<p>The <code>MemoryQueue</code> is a simple in-memory queue implementation suitable for development and testing. It is not persistent and will lose all data when the server restarts. It does not work across multiple processes or servers.</p>"},{"location":"queueing/#databasequeue","title":"DatabaseQueue","text":"<p>The <code>DatabaseQueue</code> uses a database table to store jobs, providing persistence and the ability to share jobs across multiple processes and servers. Failed jobs are automatically moved to a dead-letter queue (named <code>{queueName}-failed</code>) after exceeding the maximum retry attempts. The queue implements exponential backoff for retries.</p>"},{"location":"queueing/#redisqueue","title":"RedisQueue","text":"<p>The <code>RedisQueue</code> is implemented in the web-framework-redis module. Persistency depends on your configuration of Redis, but it's shareable between multiple instantiations and / or servers.</p>"},{"location":"queueing/#best-practices","title":"Best Practices","text":"<ol> <li>Keep jobs small and focused on a single task</li> <li>Use job handlers for the actual processing logic</li> <li>Implement proper error handling in job handlers</li> <li>Use appropriate queue names for different types of jobs</li> <li>Consider using delays for non-urgent tasks</li> <li>Monitor queue sizes and processing times</li> <li>Implement proper logging in job handlers </li> </ol>"},{"location":"routing/","title":"Routing","text":"<p>This document provides a guide for developers on how to set up routes in the WebFramework. Routes define the endpoints of your application and map them to specific actions or controllers. WebFramework uses the Slim framework for request handling. So the basic routing rules are defined in the Slim framework documentation.</p>"},{"location":"routing/#setting-up-routes","title":"Setting Up Routes","text":"<p>Routes are defined in the configuration under the <code>routes</code> key. The configuration specifies the route classes to load, which are responsible for registering the routes with the Slim application.</p>"},{"location":"routing/#configuration","title":"Configuration","text":"<p>In your <code>config/config.php</code> file, specify the route classes to load:</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p> <pre><code>&lt;?php\n\nreturn [\n    // Other configuration settings...\n\n    'routes' =&gt; [\n        \\App\\Routes\\Unauthenticated::class,\n        \\App\\Routes\\Authenticated::class,\n    ],\n];\n</code></pre>"},{"location":"routing/#route-classes","title":"Route Classes","text":"<p>Route classes should implement the <code>RouteSet</code> interface and are usually placed in the <code>routes</code> directory. But you could place them anywhere you want as long as you configure Composer and the autoloader can find them. Each route class is responsible for registering its routes with the Slim application.</p>"},{"location":"routing/#example-unauthenticated-routes","title":"Example: Unauthenticated Routes","text":"<p>Here's an example of a route class for unauthenticated routes using the basic WebFramework actions for authentication. You don't need to use these actions, but they provide a good starting point.</p> <pre><code>&lt;?php\n\nnamespace App\\Routes;\n\nuse Slim\\App;\nuse WebFramework\\Http\\RouteSet;\n\nclass Unauthenticated implements RouteSet\n{\n    public function register(App $app): void\n    {\n        // Login / verification related\n        //\n        $app-&gt;get('/login', \\WebFramework\\Actions\\Login::class);\n        $app-&gt;post('/login', \\WebFramework\\Actions\\Login::class);\n        $app-&gt;get('/login/verify', \\WebFramework\\Actions\\LoginVerify::class);\n\n        $app-&gt;get('/logoff', \\WebFramework\\Actions\\Logoff::class);\n\n        $app-&gt;get('/change-email', \\WebFramework\\Actions\\ChangeEmail::class);\n        $app-&gt;post('/change-email', \\WebFramework\\Actions\\ChangeEmail::class);\n        $app-&gt;get('/change-email/verify', \\WebFramework\\Actions\\ChangeEmailVerify::class);\n\n        $app-&gt;get('/reset-password', \\WebFramework\\Actions\\ResetPassword::class);\n        $app-&gt;post('/reset-password', \\WebFramework\\Actions\\ResetPassword::class);\n        $app-&gt;get('/reset-password/verify', \\WebFramework\\Actions\\ResetPasswordVerify::class);\n\n        $app-&gt;get('/verify', \\WebFramework\\Actions\\Verify::class);\n        $app-&gt;post('/verify', \\WebFramework\\Actions\\Verify::class);\n\n        $app-&gt;get('/verify', \\WebFramework\\Actions\\Verify::class);\n        $app-&gt;post('/verify', \\WebFramework\\Actions\\Verify::class);\n        $app-&gt;post('/verify/resend', \\WebFramework\\Actions\\VerifyResend::class);\n\n        // Registration related\n        //\n        $app-&gt;get('/register', \\WebFramework\\Actions\\Register::class);\n        $app-&gt;post('/register', \\WebFramework\\Actions\\Register::class);\n        $app-&gt;get('/register/verify', \\WebFramework\\Actions\\RegisterVerify::class);\n    }\n}\n</code></pre>"},{"location":"routing/#example-authenticated-routes","title":"Example: Authenticated Routes","text":"<p>For authenticated routes, you can use the <code>WebFramework\\Middleware\\LoggedInMiddleware</code> to ensure that the user is logged in before accessing certain routes.</p>"},{"location":"routing/#authenticated-route-group","title":"Authenticated Route Group","text":"<p>You can then create a route group for authenticated routes, using the <code>LoggedInMiddleware</code> to protect the routes:</p> <pre><code>&lt;?php\n\nnamespace App\\Routes;\n\nuse Slim\\App;\nuse Slim\\Routing\\RouteCollectorProxy;\nuse WebFramework\\Http\\RouteSet;\nuse WebFramework\\Middleware\\LoggedInMiddleware;\n\n// Authenticated (but not linked to account type)\n//\nclass Authenticated implements RouteSet\n{\n    public function __construct(\n        private LoggedInMiddleware $loggedInMiddleware,\n    ) {\n    }\n\n    public function register(App $app): void\n    {\n        $app-&gt;group('', function (RouteCollectorProxy $group) {\n            $group-&gt;get('/', \\App\\Actions\\Main::class);\n\n            $group-&gt;get('/change-password', \\WebFramework\\Actions\\ChangePassword::class);\n            $group-&gt;post('/change-password', \\WebFramework\\Actions\\ChangePassword::class);\n\n            $group-&gt;get('/settings', \\App\\Actions\\Settings::class);\n        })\n            -&gt;add($this-&gt;loggedInMiddleware)\n        ;\n    }\n}\n</code></pre> <p>In this example, the <code>Authenticated</code> route group uses the <code>LoggedInMiddleware</code> to ensure that only authenticated users can access the routes within the group.</p>"},{"location":"sanity-checks/","title":"Sanity Check System","text":"<p>This document provides a guide for developers on the sanity check system in WebFramework. Sanity checks are used to ensure that the application environment and configuration are correct and that the application is ready to run.</p>"},{"location":"sanity-checks/#overview","title":"Overview","text":"<p>The sanity check system in WebFramework is designed to perform various checks on the application environment and configuration. It is managed by the <code>SanityCheckRunner</code> and executed as part of the <code>BootstrapService</code>.</p>"},{"location":"sanity-checks/#when-sanity-checks-are-run","title":"When Sanity Checks Are Run","text":"<p>Sanity checks are typically run during the bootstrap process of the application. They are executed if the <code>runSanityChecks</code> flag is set to <code>true</code> in the <code>BootstrapService</code>. This is usually the case in development and testing environments.</p>"},{"location":"sanity-checks/#debug-environment","title":"Debug Environment","text":"<p>Sanity checks are run by default in debug environments. You can control whether sanity checks are run by setting the <code>runSanityChecks</code> flag in the <code>BootstrapService</code>.</p>"},{"location":"sanity-checks/#production-environment","title":"Production Environment","text":"<p>In a production environment, sanity checks are only run once on each new 'commit' that is seen in the BuildInfo.</p>"},{"location":"sanity-checks/#triggering-sanity-checks-manually","title":"Triggering Sanity Checks Manually","text":"<p>You can manually trigger sanity checks by running the <code>sanity_check.php</code> script. This script initializes the application and executes the <code>SanityCheckTask</code>.</p>"},{"location":"sanity-checks/#example-command","title":"Example Command","text":"<pre><code>php scripts/sanity_check.php\n</code></pre> <p>This command will execute all registered sanity checks and output the results to the console.</p>"},{"location":"sanity-checks/#adding-your-own-sanity-checks","title":"Adding Your Own Sanity Checks","text":"<p>To add your own sanity checks, you need to create a class that implements the <code>SanityCheckModule</code> interface. This interface defines the contract for sanity check modules.</p>"},{"location":"sanity-checks/#example-sanity-check-module","title":"Example Sanity Check Module","text":"<pre><code>&lt;?php\n\nnamespace App\\SanityCheck;\n\nuse WebFramework\\SanityCheck\\SanityCheckBase;\n\nclass CustomSanityCheck extends SanityCheckBase\n{\n    public function performChecks(): bool\n    {\n        // Implement your custom checks here\n        // Return true if all checks pass, false otherwise\n        return true;\n    }\n}\n</code></pre>"},{"location":"sanity-checks/#configuring-sanity-checks","title":"Configuring Sanity Checks","text":"<p>Sanity checks are enabled and configured in the application's configuration file under the <code>sanity_check_modules</code> key. This key contains an associative array with fully qualified class names as keys and their respective configuration arrays as values.</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p>"},{"location":"sanity-checks/#example-configuration","title":"Example Configuration","text":"<pre><code>&lt;?php\n\nreturn [\n    // Other configuration settings...\n\n    'sanity_check_modules' =&gt; [\n        \\App\\SanityCheck\\CustomSanityCheck::class =&gt; [],\n    ],\n];\n</code></pre>"},{"location":"sanity-checks/#existing-sanity-check-modules","title":"Existing Sanity Check Modules","text":"<p>Here is a description of the existing sanity check modules and their configuration:</p>"},{"location":"sanity-checks/#requiredcoreconfig-built-in","title":"RequiredCoreConfig (Built-in)","text":"<ul> <li>Purpose: Checks for required core configuration options.</li> <li>Configuration: No additional configuration is required.</li> </ul>"},{"location":"sanity-checks/#databasecompatibility-built-in","title":"DatabaseCompatibility (Built-in)","text":"<ul> <li>Purpose: Checks for database compatibility, including version checks.</li> <li>Configuration: No additional configuration is required.</li> </ul>"},{"location":"sanity-checks/#requiredauth","title":"RequiredAuth","text":"<ul> <li>Purpose: Checks for the presence of required authentication files.</li> <li>Configuration: An array of filenames to check for.</li> </ul>"},{"location":"sanity-checks/#example","title":"Example","text":"<pre><code>&lt;?php\n\nreturn [\n    'sanity_check_modules' =&gt; [\n        \\WebFramework\\SanityCheck\\RequiredAuth::class =&gt; [\n            'auth_file_1.php',\n            'auth_file_2.php',\n        ],\n    ],\n];\n</code></pre>"},{"location":"tasks/","title":"Tasks","text":"<p>This document provides a guide for developers on how to create and run tasks in the WebFramework. Tasks are used to perform specific operations, such as database initialization or updates, and can be executed from the command line.</p>"},{"location":"tasks/#overview","title":"Overview","text":"<p>Tasks in WebFramework implement the <code>Task</code>, which defines a single method, <code>execute()</code>. This method contains the logic for the task. Tasks are executed using the <code>TaskRunner</code>, which sets up the application environment and runs the specified task.</p>"},{"location":"tasks/#creating-custom-tasks","title":"Creating Custom Tasks","text":"<p>To create a custom task, you need to implement the <code>Task</code> and define the <code>execute()</code> method. This method should contain the logic for your task.</p>"},{"location":"tasks/#example-custom-task","title":"Example: Custom Task","text":"<pre><code>&lt;?php\n\nnamespace App\\Task;\n\nuse WebFramework\\Core\\Task;\n\nclass CustomTask implements Task\n{\n    public function execute(): void\n    {\n        // Task logic goes here\n        echo \"Running custom task...\";\n    }\n}\n</code></pre> <p>In this example, the <code>CustomTask</code> class implements the <code>Task</code> and defines the <code>execute()</code> method, which contains the task logic.</p>"},{"location":"tasks/#running-tasks-from-the-command-line","title":"Running Tasks from the Command Line","text":"<p>Tasks can be executed from the command line using PHP scripts. These scripts initialize the <code>TaskRunner</code> and execute the specified task.</p>"},{"location":"tasks/#example-running-a-task","title":"Example: Running a Task","text":"<p>To run a task from the command line, create a script similar to the following:</p> <pre><code>&lt;?php\n\nuse WebFramework\\Core\\TaskRunner;\nuse App\\Task\\CustomTask;\n\nrequire_once __DIR__.'/../vendor/autoload.php';\n\n$taskRunner = new TaskRunner(__DIR__.'/..');\n$taskRunner-&gt;build();\n\n$taskRunner-&gt;execute(CustomTask::class);\n</code></pre> <p>This script initializes the <code>TaskRunner</code>, builds the application environment, and executes the <code>CustomTask</code>.</p>"},{"location":"tasks/#existing-tasks","title":"Existing Tasks","text":"<p>The WebFramework includes several predefined tasks for common operations. Here are the existing tasks and their purposes:</p>"},{"location":"tasks/#slimapptask","title":"SlimAppTask","text":"<ul> <li>Purpose: Initializes and runs the Slim application.</li> <li>Script: <code>public/index.php</code></li> <li>Script: Typically run as part of the web server setup, not directly from the command line.</li> </ul>"},{"location":"tasks/#dbinittask","title":"DbInitTask","text":"<ul> <li>Purpose: Initializes the database schema.</li> <li>Script: <code>scripts/db_init.php</code></li> <li>Usage: Run this script to set up the initial database schema.</li> </ul>"},{"location":"tasks/#dbupdatetask","title":"DbUpdateTask","text":"<ul> <li>Purpose: Updates the database schema to the latest version.</li> <li>Script: <code>scripts/db_update.php</code></li> <li>Usage: Run this script to apply database migrations and update the schema.</li> </ul>"},{"location":"tasks/#dbversiontask","title":"DbVersionTask","text":"<ul> <li>Purpose: Displays the current database version.</li> <li>Script: <code>scripts/db_version.php</code></li> <li>Usage: Run this script to check the current version of the database schema.</li> </ul>"},{"location":"tasks/#sanitychecktask","title":"SanityCheckTask","text":"<ul> <li>Purpose: Runs sanity checks on the application.</li> <li>Script: <code>scripts/sanity_check.php</code></li> <li>Usage: Run this script to perform sanity checks and ensure the application environment is correct.</li> </ul>"},{"location":"templating/","title":"Rendering and Templating","text":"<p>This document provides a guide for developers on how rendering and templating work in the WebFramework. It covers the default renderer, how to create your own action, set up parameters, and pass them to a template.</p>"},{"location":"templating/#overview-of-rendering-in-webframework","title":"Overview of Rendering in WebFramework","text":"<p>The WebFramework uses the <code>RenderService</code> interface to define the contract for rendering services. The default implementation of this interface is the <code>LatteRenderService</code>, which uses the Latte templating engine to render templates.</p>"},{"location":"templating/#default-renderer-latterenderservice","title":"Default Renderer: LatteRenderService","text":"<p>The <code>LatteRenderService</code> is the default renderer in WebFramework. It uses the Latte templating engine to render templates and return responses. Latte is a powerful and secure templating engine for PHP, known for its clean syntax and flexibility.</p>"},{"location":"templating/#key-features-of-latte","title":"Key Features of Latte","text":"<ul> <li>Secure: Automatically escapes output to prevent XSS attacks.</li> <li>Flexible: Supports custom filters and functions.</li> <li>Fast: Compiles templates to PHP code for high performance.</li> </ul> <p>For more information about Latte, visit the Latte Framework website.</p>"},{"location":"templating/#creating-your-own-action","title":"Creating Your Own Action","text":"<p>To create your own action in WebFramework, you need to define a class that handles the request and response. This class will use the <code>RenderService</code> to render a template.</p>"},{"location":"templating/#example-action-helloworldaction","title":"Example Action: HelloWorldAction","text":"<pre><code>&lt;?php\n\nnamespace App\\Actions;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface as Request;\nuse WebFramework\\Presentation\\RenderService;\n\nclass HelloWorldAction\n{\n    public function __construct(\n        private RenderService $renderService,\n    ) {}\n\n    public function __invoke(Request $request, ResponseInterface $response): ResponseInterface\n    {\n        $params = ['name' =&gt; 'World'];\n\n        return $this-&gt;renderService-&gt;render($request, $response, 'hello-world.latte', $params);\n    }\n}\n</code></pre> <p>In this example, the <code>HelloWorldAction</code> class uses the <code>RenderService</code> to render a template called <code>hello-world.latte</code>, passing a parameter <code>name</code> with the value <code>World</code>.</p>"},{"location":"templating/#setting-up-parameters-and-passing-them-to-a-template","title":"Setting Up Parameters and Passing Them to a Template","text":"<p>Parameters are passed to the template as an associative array. These parameters can be accessed within the template using their keys.</p>"},{"location":"templating/#example-template-hello-worldlatte","title":"Example Template: hello-world.latte","text":"<pre><code>Hello, {$name}!\n</code></pre> <p>In this template, the <code>name</code> parameter is accessed using the <code>{$name}</code> syntax, and the output will be \"Hello, World!\".</p>"},{"location":"translations/","title":"Multi-Lingual Support","text":"<p>This document provides a guide for developers on how to deploy and configure multi-lingual support in an application using the WebFramework. The framework provides a robust translation system that allows you to manage translations for different languages.</p>"},{"location":"translations/#overview","title":"Overview","text":"<p>The WebFramework uses a combination of translation services and loaders to manage translations. The <code>TranslationService</code> is the main service responsible for providing translation functionality, while the <code>FileTranslationLoader</code> is used to load translations from files. This is all handled by the <code>BootstrapService</code>, so you don't have to worry about it.</p>"},{"location":"translations/#setting-up-translations","title":"Setting Up Translations","text":""},{"location":"translations/#step-1-define-translation-files","title":"Step 1: Define Translation Files","text":"<p>Translation files are PHP files that return an associative array of translation keys and their corresponding translations. These files are typically organized by language and category.</p>"},{"location":"translations/#example-translation-file","title":"Example Translation File","text":"<p>Create a file named <code>en.php</code> in your translations directory. For all messages in the WebFramework there is already a default translation in English.You can override default translations by using the same key in your translation file.</p> <pre><code>&lt;?php\n\nreturn [\n    'authenticator' =&gt; [\n        'auth_required_message' =&gt; 'Authentication required. Please login.',\n    ],\n    'change_email' =&gt; [\n        'duplicate' =&gt; 'E-mail address is already in use in another account',\n        'success' =&gt; 'E-mail address changed successfully',\n    ],\n    // Add more categories and translations as needed\n];\n</code></pre>"},{"location":"translations/#step-2-configure-translation-directories","title":"Step 2: Configure Translation Directories","text":"<p>In your configuration file (e.g., <code>config.php</code>), specify the directories where translation files are located. This is done under the <code>translations</code> key.</p> <p>For available configuration options and default settings, see <code>config/base_config.php</code>.</p> <pre><code>&lt;?php\n\nreturn [\n    // Other configuration settings...\n\n    'translations' =&gt; [\n        'default_language' =&gt; 'en',\n        'directories' =&gt; [\n            'translations', // Directory containing translation files\n        ],\n    ],\n];\n</code></pre> <p>You can override the default language by setting the <code>default_language</code> in your configuration file.</p>"},{"location":"translations/#step-3-use-the-translation-functions","title":"Step 3: Use the Translation Functions","text":"<p>The WebFramework provides helper functions <code>__()</code> and <code>__C()</code> to retrieve translations in your application. These functions use the <code>TranslationService</code> to fetch translations.</p>"},{"location":"translations/#example-usage","title":"Example Usage","text":"<pre><code>&lt;?php\n\n// Translate a specific tag within a category\n$message = __('notifications', 'hello_world');\n\n// Get all translations for a specific category\n$genderOptions = __C('genders');\n</code></pre> <p>In this example, the <code>__()</code> function is used to retrieve a specific translation, while the <code>__C()</code> function is used to retrieve all translations for a specific category. This can be useful when you need to retrieve all options for a selection input in your template.</p>"},{"location":"translations/#handling-messages-with-translations","title":"Handling Messages with Translations","text":"<p>The <code>MessageService</code> is used to manage messages in the application, including translating message keys into their corresponding translations.</p>"},{"location":"translations/#adding-messages","title":"Adding Messages","text":"<p>When adding a message, you can specify a translation key instead of a plain text message. The <code>MessageService</code> will automatically translate the key using the <code>TranslationService</code>.</p>"},{"location":"translations/#example","title":"Example","text":"<pre><code>&lt;?php\n\nuse WebFramework\\Presentation\\MessageService;\n\nclass ExampleAction\n{\n    public function __construct(\n        private MessageService $messageService,\n    ) {}\n\n    public function execute(): void\n    {\n        $this-&gt;messageService-&gt;add('info', 'authenticator.auth_required_message');\n    }\n}\n</code></pre> <p>In this example, the <code>ExampleAction</code> adds a message using a translation key. The <code>MessageService</code> translates the key into the corresponding message.</p>"},{"location":"user-management-flows/","title":"User Management Flows","text":"<p>This document describes the user management flows available in WebFramework, including registration, login, password reset, and email change processes. Understanding these flows is essential for developers building authentication and user management features.</p>"},{"location":"user-management-flows/#overview","title":"Overview","text":"<p>WebFramework provides a comprehensive set of user management flows that handle authentication, verification, and account management. All flows use a code-based verification system where users receive verification codes via email to complete sensitive operations.</p>"},{"location":"user-management-flows/#common-components","title":"Common Components","text":"<p>All user management flows share several common components:</p> <ul> <li>UserCodeService: Generates and verifies verification codes with expiration and attempt tracking</li> <li>Verification Codes Database: Codes are stored in the database with GUIDs, attempt counts, and expiration times</li> <li>Security Iterator: Prevents replay attacks by tracking security state changes</li> <li>Email Verification: Codes are sent via email and must be entered to complete flows</li> <li>Brute Force Protection: Maximum of 5 attempts per code to prevent brute force attacks</li> </ul>"},{"location":"user-management-flows/#flow-1-registration","title":"Flow 1: Registration","text":"<p>The registration flow allows new users to create accounts with email verification.</p>"},{"location":"user-management-flows/#step-1-register-action-register","title":"Step 1: Register Action (<code>/register</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Register</code></p> <p>Process: 1. User submits registration form (username, email, password, password2) 2. Validates input (username/email format, password strength, CAPTCHA) 3. Checks username/email availability 4. Calls <code>RegisterExtensionInterface::customValueCheck()</code> for custom validation 5. Gets after-verify data via <code>RegisterExtensionInterface::getAfterVerifyData()</code> 6. Creates user account via <code>RegisterService::register()</code> (which generates verification code and sends email) and dispatches <code>UserRegistered</code> event 7. Calls <code>RegisterExtensionInterface::postCreate()</code> hook 8. Redirects to Verify page with <code>guid</code> parameter</p> <p>Extension Hooks: - <code>getCustomParams()</code>: Add custom template parameters - <code>customValueCheck()</code>: Perform additional validation checks - <code>getAfterVerifyData()</code>: Provide data to pass through verification - <code>postCreate()</code>: Execute logic after user creation - <code>postVerify()</code>: Execute logic after verification (called in RegisterVerify)</p> <p>Configuration: - <code>actions.register.return_page</code>: Page to redirect after successful registration verification - <code>actions.verify.location</code>: Location of verification page</p>"},{"location":"user-management-flows/#step-2-verify-action-verify","title":"Step 2: Verify Action (<code>/verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Verify</code></p> <p>Process: 1. User enters verification code from email 2. Verifies code via <code>UserCodeService::verifyCodeByGuid()</code> 3. Validates code matches, hasn't expired, hasn't been used, and hasn't exceeded max attempts 4. Marks code as used and increments attempt counter 5. Redirects to RegisterVerify with <code>guid</code> parameter</p> <p>Required Parameters: - <code>guid</code>: GUID from registration email - <code>flow</code>: Must be 'register' - <code>code</code>: Verification code from email</p>"},{"location":"user-management-flows/#step-3-registerverify-action-register-verify","title":"Step 3: RegisterVerify Action (<code>/register-verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\RegisterVerify</code></p> <p>Process: 1. Extracts user and flow from <code>guid</code> via <code>UserVerificationService::handleData()</code> 2. Verifies flow is 'register' 3. Sets user as verified (if not already verified) 4. Authenticates user via <code>AuthenticationService::authenticate()</code> 5. Calls <code>RegisterExtensionInterface::postVerify()</code> hook (extensible for custom logic) 6. Redirects to <code>actions.register.return_page</code></p> <p>Customization: Implement <code>RegisterExtensionInterface</code> and configure it in dependency injection to add custom logic.</p>"},{"location":"user-management-flows/#flow-2-login-with-verification","title":"Flow 2: Login with Verification","text":"<p>The login flow handles user authentication, including cases where users need to verify their email.</p>"},{"location":"user-management-flows/#step-1-login-action-login","title":"Step 1: Login Action (<code>/login</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Login</code></p> <p>Process: 1. User submits credentials (username/email, password) 2. Validates credentials via <code>LoginService::validate()</code> 3. Checks if user is verified and verification hasn't expired 4. If user not verified \u2192 throws <code>UserVerificationRequiredException</code> 5. Calls <code>LoginExtensionInterface::customValueCheck()</code> for custom validation 6. If checks pass, authenticates user and redirects and dispatches <code>UserLoggedIn</code> event 7. If user not verified, generates verification code entry and sends verification email 8. Redirects to Verify page with <code>guid</code> parameter</p> <p>Extension Hooks: - <code>getCustomParams()</code>: Add custom template parameters - <code>customValueCheck()</code>: Perform additional validation checks before authentication</p> <p>Configuration: - <code>actions.login.default_return_page</code>: Default page after successful login - <code>actions.login.after_verify_page</code>: Page to redirect after verification - <code>actions.verify.location</code>: Location of verification page</p> <p>Note: If user is already verified, login proceeds directly without verification step.</p>"},{"location":"user-management-flows/#step-2-verify-action-verify_1","title":"Step 2: Verify Action (<code>/verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Verify</code></p> <p>Process: 1. User enters verification code from email 2. Verifies code via <code>UserCodeService::verifyCodeByGuid()</code> 3. Marks code as used 4. Redirects to LoginVerify with <code>guid</code> parameter</p> <p>Required Parameters: - <code>guid</code>: GUID from login verification email - <code>flow</code>: Must be 'login' - <code>code</code>: Verification code from email</p>"},{"location":"user-management-flows/#step-3-loginverify-action-login-verify","title":"Step 3: LoginVerify Action (<code>/login-verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\LoginVerify</code></p> <p>Process: 1. Extracts user, flow, and after_verify_data from <code>guid</code> 2. Verifies flow is 'login' 3. Authenticates user via <code>AuthenticationService::authenticate()</code> 4. Redirects to <code>after_verify_data['return_page']</code> with <code>return_query</code> parameters</p>"},{"location":"user-management-flows/#flow-3-password-reset","title":"Flow 3: Password Reset","text":"<p>The password reset flow allows users to reset forgotten passwords via email verification.</p>"},{"location":"user-management-flows/#step-1-resetpassword-action-reset-password","title":"Step 1: ResetPassword Action (<code>/reset-password</code>)","text":"<p>Action: <code>WebFramework\\Actions\\ResetPassword</code></p> <p>Process: 1. User submits username/email 2. Validates input 3. Calls <code>ResetPasswordExtensionInterface::customValueCheck()</code> for custom validation 4. Finds user via <code>UserRepository::getUserByUsername()</code> 5. Calls <code>ResetPasswordService::sendPasswordResetMail()</code> 6. Generates verification code entry in database with action='reset_password' 7. Increments security iterator to invalidate old reset links 8. Sends password reset email with code 9. Redirects to Verify page with <code>guid</code> parameter</p> <p>Extension Hooks: - <code>getCustomParams()</code>: Add custom template parameters - <code>customValueCheck()</code>: Perform additional validation checks</p> <p>Configuration: - <code>actions.reset_password.after_verify_page</code>: Page to redirect after verification - <code>actions.verify.location</code>: Location of verification page</p>"},{"location":"user-management-flows/#step-2-verify-action-verify_2","title":"Step 2: Verify Action (<code>/verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Verify</code></p> <p>Process: 1. User enters verification code from email 2. Verifies code via <code>UserCodeService::verifyCodeByGuid()</code> 3. Marks code as used 4. Redirects to ResetPasswordVerify with <code>guid</code> parameter</p> <p>Required Parameters: - <code>guid</code>: GUID from password reset email - <code>flow</code>: Must be 'reset_password' - <code>code</code>: Verification code from email</p>"},{"location":"user-management-flows/#step-3-resetpasswordverify-action-reset-password-verify","title":"Step 3: ResetPasswordVerify Action (<code>/reset-password-verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\ResetPasswordVerify</code></p> <p>Process: 1. Calls <code>ResetPasswordService::handleData()</code> with <code>guid</code> 2. Retrieves verification code from database and verifies security iterator matches 3. Generates new random password via <code>sendNewPassword()</code> 4. Updates password hash and increments security iterator 5. Sends new password email to user 6. Invalidates all user sessions via <code>AuthenticationService::invalidateSessions()</code> 7. Redirects to login page</p> <p>Security: The security iterator check ensures that if a user requests multiple password resets, only the most recent reset link will work.</p>"},{"location":"user-management-flows/#flow-4-change-email","title":"Flow 4: Change Email","text":"<p>The change email flow allows authenticated users to change their email address with verification.</p>"},{"location":"user-management-flows/#step-1-changeemail-action-change-email","title":"Step 1: ChangeEmail Action (<code>/change-email</code>)","text":"<p>Action: <code>WebFramework\\Actions\\ChangeEmail</code></p> <p>Process: 1. Authenticated user submits new email address 2. Validates email format and uniqueness 3. Calls <code>ChangeEmailExtensionInterface::customValueCheck()</code> for custom validation 4. Calls <code>ChangeEmailService::sendChangeEmailVerify()</code> 5. Generates verification code entry in database with action='change_email' 6. Increments security iterator 7. Sends verification email to new email address with code 8. Redirects to Verify page with <code>guid</code> parameter</p> <p>Extension Hooks: - <code>getCustomParams()</code>: Add custom template parameters - <code>customValueCheck()</code>: Perform additional validation checks</p> <p>Configuration: - <code>actions.change_email.after_verify_page</code>: Page to redirect after verification - <code>actions.change_email.return_page</code>: Page to redirect after successful email change - <code>actions.verify.location</code>: Location of verification page</p> <p>Security: Verification email is sent to the new address to ensure the user has access to it.</p>"},{"location":"user-management-flows/#step-2-verify-action-verify_3","title":"Step 2: Verify Action (<code>/verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\Verify</code></p> <p>Process: 1. Requires authentication for change_email flow 2. User enters verification code from email (sent to new address) 3. Verifies code via <code>UserCodeService::verifyCodeByGuid()</code> 4. Marks code as used 5. Redirects to ChangeEmailVerify with <code>guid</code> parameter</p> <p>Required Parameters: - <code>guid</code>: GUID from change email verification email - <code>flow</code>: Must be 'change_email' - <code>code</code>: Verification code from email</p>"},{"location":"user-management-flows/#step-3-changeemailverify-action-change-email-verify","title":"Step 3: ChangeEmailVerify Action (<code>/change-email-verify</code>)","text":"<p>Action: <code>WebFramework\\Actions\\ChangeEmailVerify</code></p> <p>Process: 1. Calls <code>ChangeEmailService::handleData()</code> with authenticated user and <code>guid</code> 2. Retrieves verification code from database 3. Verifies code belongs to current authenticated user (throws <code>WrongAccountException</code> if not) 4. Verifies security iterator hasn't changed 5. Updates email address (and username if <code>unique_identifier='email'</code>) 6. Invalidates all user sessions via <code>AuthenticationService::invalidateSessions()</code> 7. Re-authenticates user 8. Dispatches <code>UserEmailChanged</code> event 9. Redirects to <code>actions.change_email.return_page</code></p> <p>Security: Multiple security checks ensure: - Code belongs to the authenticated user - Security iterator prevents replay attacks - All sessions are invalidated after email change</p>"},{"location":"user-management-flows/#configuration-reference","title":"Configuration Reference","text":"<p>All flows require configuration in <code>config/config.php</code>. Key configuration options:</p> <pre><code>&lt;?php\n\nreturn [\n    'actions' =&gt; [\n        'login' =&gt; [\n            'location' =&gt; '/login',                 // Location of the login page\n            'after_verify' =&gt; '/login/verify',      // Location to redirect to after verifying\n            'default_return_page' =&gt; '/',           // Default return page\n            'template_name' =&gt; 'Login.latte',       // Template name for login page\n        ],\n        'reset_password' =&gt; [\n            'location' =&gt; '/reset-password',            // Location of the reset password page\n            'after_verify' =&gt; '/reset-password/verify', // Location to redirect to after verifying\n            'template_name' =&gt; 'ResetPassword.latte',   // Template name for reset password page\n        ],\n        'change_password' =&gt; [\n            'location' =&gt; '/change-password',          // Location of the change password page\n            'return_page' =&gt; '/',                      // Location to redirect after changing password\n            'template_name' =&gt; 'ChangePassword.latte', // Template name for change password page\n        ],\n        'change_email' =&gt; [\n            'location' =&gt; '/change-email',            // Location of the change email page\n            'after_verify' =&gt; '/change-email/verify', // Location of the change email verify page\n            'return_page' =&gt; '/',                     // Location to redirect after changing email\n            'template_name' =&gt; 'ChangeEmail.latte',   // Template name for change email page\n        ],\n        'register' =&gt; [\n            'location' =&gt; '/register',            // Location of the register page\n            'after_verify' =&gt; '/register/verify', // Location to redirect to after verifying\n            'return_page' =&gt; '/',                 // Default page to redirect to after verifying\n            'template_name' =&gt; 'Register.latte',  // Template name for register page\n        ],\n        'verify' =&gt; [\n            'location' =&gt; '/verify',            // Location of the verify page\n            'templates' =&gt; [                    // Template names per action type\n                'login' =&gt; 'Verify.latte',\n                'register' =&gt; 'Verify.latte',\n                'reset_password' =&gt; 'Verify.latte',\n                'change_email' =&gt; 'Verify.latte',\n            ],\n        ],\n    ],\n    'security' =&gt; [\n        'email_verification' =&gt; [\n            'code_length' =&gt; 6,             // Length of verification code\n            'code_expiry_minutes' =&gt; 15,    // Minutes until code expires\n            'max_attempts' =&gt; 5,           // Maximum verification attempts per code\n        ],\n        'validity_period_days' =&gt; 365,      // Email verification validity period\n    ],\n];\n</code></pre>"},{"location":"user-management-flows/#customization-points","title":"Customization Points","text":"<p>WebFramework uses an extension interface system for customizing user management flows. Instead of overriding action classes or service methods, implement the appropriate extension interface and configure it via dependency injection.</p>"},{"location":"user-management-flows/#extension-interfaces","title":"Extension Interfaces","text":"<p>Each flow has a corresponding extension interface:</p> <ul> <li>RegisterExtensionInterface: Customize registration flow</li> <li>LoginExtensionInterface: Customize login flow</li> <li>ChangeEmailExtensionInterface: Customize email change flow</li> <li>ChangePasswordExtensionInterface: Customize password change flow</li> <li>ResetPasswordExtensionInterface: Customize password reset flow</li> </ul>"},{"location":"user-management-flows/#implementing-an-extension","title":"Implementing an Extension","text":"<ol> <li>Create your extension class implementing the appropriate interface:</li> </ol> <pre><code>&lt;?php\n\nuse WebFramework\\Security\\Extension\\RegisterExtensionInterface;\nuse Slim\\Http\\ServerRequest as Request;\nuse WebFramework\\Entity\\User;\n\nclass MyRegisterExtension implements RegisterExtensionInterface\n{\n    public function getCustomParams(Request $request): array\n    {\n        return [\n            'customField' =&gt; 'value',\n        ];\n    }\n\n    public function customValueCheck(Request $request): bool\n    {\n        // Perform additional validation\n        return true;\n    }\n\n    public function getAfterVerifyData(Request $request): array\n    {\n        return [\n            'referral_code' =&gt; $request-&gt;getParam('referral_code'),\n        ];\n    }\n\n    public function postCreate(Request $request, User $user): void\n    {\n        // Execute logic after user creation\n        // e.g., create default settings, send welcome email\n    }\n\n    public function postVerify(User $user, array $afterVerifyParams): void\n    {\n        // Execute logic after verification\n        // e.g., process referral code from $afterVerifyParams\n    }\n}\n</code></pre> <ol> <li>Configure in dependency injection (<code>definitions/definitions.php</code>):</li> </ol> <pre><code>&lt;?php\n\nreturn [\n    // ... other definitions ...\n    Security\\Extension\\RegisterExtensionInterface::class =&gt; DI\\autowire(MyRegisterExtension::class),\n];\n</code></pre>"},{"location":"user-management-flows/#available-extension-hooks","title":"Available Extension Hooks","text":""},{"location":"user-management-flows/#registerextensioninterface","title":"RegisterExtensionInterface","text":"<ul> <li><code>getCustomParams(Request $request): array</code> - Add custom template parameters</li> <li><code>customValueCheck(Request $request): bool</code> - Perform additional validation before user creation</li> <li><code>getAfterVerifyData(Request $request): array</code> - Provide data to pass through verification</li> <li><code>postCreate(Request $request, User $user): void</code> - Execute logic after user creation</li> <li><code>postVerify(User $user, array $afterVerifyParams): void</code> - Execute logic after verification</li> </ul>"},{"location":"user-management-flows/#loginextensioninterface","title":"LoginExtensionInterface","text":"<ul> <li><code>getCustomParams(Request $request): array</code> - Add custom template parameters</li> <li><code>customValueCheck(Request $request, User $user): bool</code> - Perform additional validation before authentication</li> </ul>"},{"location":"user-management-flows/#changeemailextensioninterface","title":"ChangeEmailExtensionInterface","text":"<ul> <li><code>getCustomParams(Request $request): array</code> - Add custom template parameters</li> <li><code>customValueCheck(Request $request, User $user): bool</code> - Perform additional validation</li> </ul>"},{"location":"user-management-flows/#changepasswordextensioninterface","title":"ChangePasswordExtensionInterface","text":"<ul> <li><code>getCustomParams(Request $request): array</code> - Add custom template parameters</li> <li><code>customValueCheck(Request $request, User $user): bool</code> - Perform additional validation</li> </ul>"},{"location":"user-management-flows/#resetpasswordextensioninterface","title":"ResetPasswordExtensionInterface","text":"<ul> <li><code>getCustomParams(Request $request): array</code> - Add custom template parameters</li> <li><code>customValueCheck(Request $request): bool</code> - Perform additional validation</li> </ul>"},{"location":"user-management-flows/#default-implementations","title":"Default Implementations","text":"<p>Null implementations are provided as defaults (<code>NullRegisterExtension</code>, <code>NullLoginExtension</code>, etc.) that perform no operations. These are configured in <code>definitions/definitions.php</code> and can be replaced with your custom implementations.</p>"},{"location":"user-management-flows/#security-features","title":"Security Features","text":"<p>All flows include multiple security features:</p> <ol> <li>Code Expiration: Verification codes expire after a configured time period (default: 15 minutes)</li> <li>Attempt Tracking: Maximum of 5 attempts per code prevents brute force attacks (this is the primary protection)</li> <li>Security Iterator: Prevents replay attacks by tracking state changes</li> <li>Database Storage: Codes stored in database with GUIDs enable audit trails and tracking</li> <li>Session Invalidation: Password and email changes invalidate all sessions</li> <li>Account Verification: Ensures verification codes belong to the correct user</li> <li>CAPTCHA Protection: Registration and login can require CAPTCHA verification</li> <li>One-Time Use: Codes are marked as used after successful verification</li> </ol> <p>Note: Codes are stored in plaintext in the database. This is acceptable because: - The attempt limit (5 attempts) prevents brute force attacks - Codes expire quickly (default: 15 minutes) - Codes are single-use only - The small code space (6 characters) would be brute-forceable regardless of hashing</p>"},{"location":"user-management-flows/#events","title":"Events","text":"<p>The following events are dispatched during user management flows:</p> <ul> <li><code>UserRegistered</code>: Dispatched when a new user is registered</li> <li><code>UserVerified</code>: Dispatched when a user's email is verified</li> <li><code>UserLoggedIn</code>: Dispatched when a user successfully logs in</li> <li><code>UserEmailChanged</code>: Dispatched when a user's email is changed</li> </ul> <p>Listen to these events to add custom behavior (e.g., logging, notifications, analytics).</p>"},{"location":"user-management-flows/#error-handling","title":"Error Handling","text":"<p>All flows handle various error conditions:</p> <ul> <li>CodeVerificationException: Invalid or expired verification code</li> <li>InvalidCodeException: Code doesn't match protected data</li> <li>WrongAccountException: Code belongs to different user (change email flow)</li> <li>UserVerificationRequiredException: User needs to verify email before login</li> <li>DuplicateEmailException: Email already in use</li> <li>ValidationException: Input validation failures</li> </ul> <p>Error messages are displayed via the <code>MessageService</code> and appropriate redirects are performed.</p>"}]}